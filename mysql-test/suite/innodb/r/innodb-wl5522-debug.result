SET GLOBAL innodb_file_per_table = 1;
SELECT @@innodb_file_per_table;
@@innodb_file_per_table
1
DROP DATABASE IF EXISTS test_wl5522;
Warnings:
Note	1008	Can't drop database 'test_wl5522'; database doesn't exist
CREATE DATABASE test_wl5522;
CREATE TABLE test_wl5522.t1 (c1 INT) ENGINE = Innodb;
INSERT INTO test_wl5522.t1 VALUES (100), (200), (300);
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
FLUSH TABLES test_wl5522.t1 WITH READ LOCK;
backup: t1
UNLOCK TABLES;
DROP TABLE test_wl5522.t1;
CREATE TABLE test_wl5522.t1 (c1 INT) ENGINE = Innodb;
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
SET SESSION debug="+d,ib_import_reset_space_and_lsn_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: InnoDB: Error opening: './/test_wl5522/t1.cfg'
restore: t1
SET SESSION debug="-d,ib_import_reset_space_and_lsn_failure";
SET SESSION debug="+d,ib_import_open_tablespace_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: InnoDB: Cannot open tablespace './test_wl5522/t1.ibd' file of '"test_wl5522"."t1"' : Tablespace not found
restore: t1
SET SESSION debug="-d,ib_import_open_tablespace_failure";
SET SESSION debug="+d,ib_import_check_bitmap_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_check_bitmap_failure";
SET SESSION debug="+d,ib_import_cluster_root_adjust_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_cluster_root_adjust_failure";
SET SESSION debug="+d,ib_import_cluster_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_cluster_failure";
SET SESSION debug="+d,ib_import_sec_root_adjust_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_sec_root_adjust_failure";
SET SESSION debug="+d,ib_import_set_max_rowid_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_set_max_rowid_failure";
SET SESSION debug="+d,ib_import_before_commit_crash";
SELECT * FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
restore: t1
SET SESSION debug="-d,ib_import_before_commit_crash";
SET SESSION debug="+d,ib_import_after_commit_crash";
SELECT * FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
SET SESSION debug="-d,ib_import_after_commit_crash";
SET SESSION debug="+d,ib_import_after_checkpoint_crash";
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
SET SESSION debug="-d,ib_import_after_checkpoint_crash";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
Warnings:
Warning	1050	InnoDB: Tablespace for table test_wl5522/t1 exists. Please DISCARD the tablespace before IMPORT.
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
INSERT INTO test_wl5522.t1 VALUES(400), (500), (600);
SELECT * FROM test_wl5522.t1;
c1
100
200
300
400
500
600
DROP TABLE test_wl5522.t1;
DROP DATABASE test_wl5522;
call mtr.add_suppression("Got error -1 when reading table '.*'");
call mtr.add_suppression("InnoDB: Table '.*' tablespace is set as discarded.");
call mtr.add_suppression("InnoDB: Tablespace '.*' exists in the cache.*");
call mtr.add_suppression("InnoDB: Freeing existing tablespace '.*' entry from the cache with id.*");
call mtr.add_suppression("InnoDB: The table .* doesn't have a corresponding tablespace, it was discarded");
SET GLOBAL INNODB_FILE_PER_TABLE=0;
