CREATE TABLE ibtest11a (
a INT, d INT, b VARCHAR(20), c VARCHAR(75), 
PRIMARY KEY (a, d, b), INDEX (b, c), INDEX (c))
ENGINE = INNODB;
CREATE TABLE ibtest11c (
a INT, d INT, b VARCHAR(20), c VARCHAR(75),
PRIMARY KEY (a, d, b), INDEX (b, c), INDEX (c),
FOREIGN KEY (a, d) REFERENCES ibtest11a (a, d)
ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT kukkuu FOREIGN KEY (b, c) REFERENCES ibtest11a (b, c)
ON DELETE CASCADE ON UPDATE CASCADE)
ENGINE = INNODB;
INSERT INTO ibtest11a VALUES (1, 5, 'khD','khD');
SET DEBUG_SYNC = 'foreign_constraint_check_for_ins WAIT_FOR drop_done';
INSERT INTO ibtest11c VALUES (1, 5, 'khD','khD');
CREATE INDEX idx1 ON ibtest11a(b, c);
Warnings:
Warning	1831	Duplicate index 'idx1' defined on the table 'test.ibtest11a'. This is deprecated and will be disallowed in a future release.
DROP INDEX b ON ibtest11a;
SET DEBUG_SYNC = 'now SIGNAL drop_done';
SET DEBUG_SYNC = 'foreign_constraint_check_for_update WAIT_FOR drop_done';
DELETE FROM ibtest11a WHERE a = 1;
CREATE INDEX idx ON ibtest11c(b, c);
Warnings:
Warning	1831	Duplicate index 'idx' defined on the table 'test.ibtest11c'. This is deprecated and will be disallowed in a future release.
DROP INDEX b ON ibtest11c;
SET DEBUG_SYNC = 'now SIGNAL drop_done';
SELECT * FROM ibtest11c;
a	d	b	c
SELECT * FROM ibtest11a;
a	d	b	c
INSERT INTO ibtest11a VALUES (1, 5, 'khD','khD');
INSERT INTO ibtest11c VALUES (1, 5, 'khD','khD');
SET DEBUG_SYNC = 'foreign_constraint_check_for_update WAIT_FOR drop_done';
UPDATE ibtest11a SET a = 2;
ALTER TABLE ibtest11c ADD INDEX idx_2(B, C), DROP INDEX idx,
ALGORITHM=INPLACE, LOCK=NONE;
ERROR 42000: This version of MySQL doesn't yet support 'ALTER TABLE ibtest11c ADD INDEX idx_2(B, C), DROP INDEX idx,
ALGORITHM=INPLACE, LOCK=NONE'
ALTER TABLE ibtest11c ADD INDEX idx_2(B, C), DROP INDEX idx, ALGORITHM=INPLACE;
SET DEBUG_SYNC = 'now SIGNAL drop_done';
SELECT * FROM ibtest11c;
a	d	b	c
2	5	khD	khD
SELECT * FROM ibtest11a;
a	d	b	c
2	5	khD	khD
DROP TABLE ibtest11c;
DROP TABLE ibtest11a;
SET DEBUG_SYNC = 'RESET';
