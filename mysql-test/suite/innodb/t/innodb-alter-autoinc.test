--source include/have_innodb.inc

CREATE TABLE t1 (a INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES(347),(33101);
--error ER_DUP_ENTRY
ALTER TABLE t1 ADD id INT AUTO_INCREMENT PRIMARY KEY;
ALTER TABLE t1 ADD PRIMARY KEY(a);
--error ER_DUP_ENTRY
ALTER TABLE t1 DROP PRIMARY KEY, ADD id INT AUTO_INCREMENT PRIMARY KEY;

--error ER_WRONG_AUTO_KEY
ALTER TABLE t1 ADD id INT AUTO_INCREMENT;
--error ER_WRONG_AUTO_KEY
ALTER TABLE t1 ADD id INT AUTO_INCREMENT, ADD INDEX(a, id);
ALTER TABLE t1 ADD id INT AUTO_INCREMENT, ADD INDEX(id, a);

SELECT * FROM t1;
ALTER TABLE t1 DROP COLUMN id;
--error ER_DUP_ENTRY
ALTER TABLE t1 DROP PRIMARY KEY, ADD id INT AUTO_INCREMENT PRIMARY KEY;

DELETE FROM t1 LIMIT 1;
ALTER TABLE t1 DROP PRIMARY KEY, ADD id INT AUTO_INCREMENT PRIMARY KEY;
SELECT * FROM t1;

INSERT INTO t1 SET a=123;
SELECT * FROM t1;

DROP TABLE t1;
