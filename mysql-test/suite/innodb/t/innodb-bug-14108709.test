-- source include/have_innodb.inc

--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings

CREATE TABLE t1(c1 INT) ENGINE=InnoDB;
SET SESSION TRANSACTION READ ONLY;
XA START 'x';
SELECT c1 FROM t1;
XA END 'x';
XA PREPARE 'x';
XA ROLLBACK 'x';

XA START 'x';
--error ER_CANT_EXECUTE_IN_READ_ONLY_TRANSACTION
INSERT INTO t1 VALUES(1);
XA END 'x';
XA PREPARE 'x';
XA ROLLBACK 'x';

# Otherwise we can't drop the table
SET SESSION TRANSACTION READ WRITE;

DROP TABLE t1;
