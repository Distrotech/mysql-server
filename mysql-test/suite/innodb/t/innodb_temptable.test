--source include/have_innodb.inc

#
# create test-bed
#
set @global_innodb_file_per_table_orig = @@global.innodb_file_per_table;
set global innodb_file_per_table = off;

#
# Test generate dml+ddl operations
#
--disable_warnings
drop table if exists t1;
--enable_warnings
select @@global.innodb_file_per_table;
create temporary table t1 (i int, f float, c char(100)) engine=innodb;
#
# insert test
insert into t1 values (100, 1.1, 'pune');
insert into t1 values (99, 1.2, 'mumbai');
insert into t1 values (98, 1.3, 'jaipur');
insert into t1 values (97, 1.4, 'delhi');
insert into t1 values (96, 1.5, 'ahmedabad');
select * from t1;
#
# add index using alter table table
explain select * from t1 where f > 1.29999;
alter table t1 add index sec_index(f);
explain select * from t1 where f > 1.29999;
select * from t1 where f > 1.29999;
#
explain select * from t1 where i = 100;
alter table t1 add unique index pri_index(i);
explain select * from t1 where i = 100;
select * from t1 where i = 100;
#
# delete test
delete from t1 where i < 97;
insert into t1 values (96, 1.5, 'kolkata');
select * from t1;
#
# update test
update t1 set f = 1.44 where c = 'delhi';
select * from t1;
#
# truncate table
truncate table t1;
insert into t1 values (100, 1.1, 'pune');
insert into t1 values (99, 1.2, 'mumbai');
insert into t1 values (98, 1.3, 'jaipur');
insert into t1 values (97, 1.4, 'delhi');
insert into t1 values (96, 1.5, 'ahmedabad');
select * from t1;
#
# drop table
drop table t1;


#
# Test for bulk loading.
#
create temporary table t1 (keyc int, c char(100), primary key(keyc)) engine=innodb;
delimiter |;
CREATE PROCEDURE populate_t1()
BEGIN
        DECLARE i INT DEFAULT 1;
        while (i <= 10000) DO
		insert into t1 values (i, 'a');
                SET i = i + 1;
        END WHILE;
END|
delimiter ;|
set autocommit=0;
select count(*) from t1;
CALL populate_t1();
select count(*) from t1;
select * from t1 limit 10;
set autocommit=1;
truncate table t1;
select count(*) from t1;
#
drop procedure populate_t1;
drop table t1;

#
# remove test-bed
#
SET global innodb_file_per_table = @global_innodb_file_per_table_orig;


