DROP TABLE IF EXISTS t1,t2,t3,t4;
create temporary table spj_counts_at_startup 
select counter_name, sum(val) AS val 
from ndbinfo.counters 
where block_name='DBSPJ' 
group by counter_name;
set @save_ndb_join_pushdown = @@session.ndb_join_pushdown;
set ndb_join_pushdown = true;
CREATE TABLE t1 (
a int NOT NULL,
b int NOT NULL,
c int NOT NULL,
d int NOT NULL,
PRIMARY KEY (`a`,`b`)
) ENGINE=ndbcluster;
insert into t1 values
(1,1,1,1), (2,2,2,2), (3,3,3,3), (4,4,4,4),
(1,2,5,1), (1,3,1,2), (1,4,2,3),
(2,1,3,4), (2,3,4,5), (2,4,5,1),
(3,1,1,2), (3,2,2,3), (3,4,3,4),
(4,1,4,5), (4,2,5,1), (4,3,1,2);
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2
1	4	2	3	4	2	5	1
2	1	3	4	1	3	1	2
2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4
3	1	1	2	1	1	1	1
3	2	2	3	2	2	2	2
3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2
4	1	4	5	1	4	2	3
4	3	1	2	3	1	1	2
4	4	4	4	4	4	4	4
explain
select *
from t1
left join t1 as t2 on t2.a = t1.b and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.b and t2.b = t1.c;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	NULL	NULL	NULL	NULL
1	3	1	2	3	1	1	2
1	4	2	3	4	2	5	1
2	1	3	4	1	3	1	2
2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4
2	4	5	1	NULL	NULL	NULL	NULL
3	1	1	2	1	1	1	1
3	2	2	3	2	2	2	2
3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2
4	1	4	5	1	4	2	3
4	2	5	1	NULL	NULL	NULL	NULL
4	3	1	2	3	1	1	2
4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4	3	4	3	4
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	3	1	2	3	1	1	2	3	1	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
left join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.a,test.t2.b	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
left join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4	3	4	3	4
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	3	1	2	3	1	1	2	3	1	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
left join t1 as t2 on t2.a = t1.b and t2.b = t1.c
left join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.a,test.t2.b	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.b and t2.b = t1.c
left join t1 as t3 on t3.a = t2.a and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	2	5	1	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4	3	4	3	4
2	4	5	1	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	2	5	1	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
4	3	1	2	3	1	1	2	3	1	1	2
4	4	4	4	4	4	4	4	4	4	4	4
set ndb_join_pushdown=true;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
a	b	c	d	a	b	c	d
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
a	b	c	d	a	b	c	d
2	3	4	5	NULL	NULL	NULL	NULL
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3
order by t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1; Using where; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3
order by t1.c;
a	b	c	d	a	b	c	d
2	3	4	5	NULL	NULL	NULL	NULL
set ndb_join_pushdown=false;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE noticed after reading const tables
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
a	b	c	d	a	b	c	d
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	const	PRIMARY	PRIMARY	8	const,const	0	unique row not found
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 2 and t1.b = 3;
a	b	c	d	a	b	c	d
2	3	4	5	NULL	NULL	NULL	NULL
set ndb_join_pushdown=true;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
set ndb_join_pushdown=false;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	const	PRIMARY	PRIMARY	8	const,const	1	
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	const	PRIMARY	PRIMARY	8	const,const	1	
select *
from t1
left join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
set ndb_join_pushdown=true;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t1.c and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t2.b	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t1.c and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	2	5	1	1	2	5	1
1	1	1	1	1	3	1	2	1	3	1	2
1	1	1	1	1	4	2	3	1	4	2	3
1	3	1	2	1	1	1	1	1	1	1	1
1	3	1	2	1	2	5	1	1	2	5	1
1	3	1	2	1	3	1	2	1	3	1	2
1	3	1	2	1	4	2	3	1	4	2	3
1	4	2	3	2	1	3	4	2	1	3	4
1	4	2	3	2	2	2	2	2	2	2	2
1	4	2	3	2	3	4	5	2	3	4	5
1	4	2	3	2	4	5	1	2	4	5	1
2	1	3	4	3	1	1	2	3	1	1	2
2	1	3	4	3	2	2	3	3	2	2	3
2	1	3	4	3	3	3	3	3	3	3	3
2	1	3	4	3	4	3	4	3	4	3	4
2	2	2	2	2	1	3	4	2	1	3	4
2	2	2	2	2	2	2	2	2	2	2	2
2	2	2	2	2	3	4	5	2	3	4	5
2	2	2	2	2	4	5	1	2	4	5	1
2	3	4	5	4	1	4	5	4	1	4	5
2	3	4	5	4	2	5	1	4	2	5	1
2	3	4	5	4	3	1	2	4	3	1	2
2	3	4	5	4	4	4	4	4	4	4	4
3	1	1	2	1	1	1	1	1	1	1	1
3	1	1	2	1	2	5	1	1	2	5	1
3	1	1	2	1	3	1	2	1	3	1	2
3	1	1	2	1	4	2	3	1	4	2	3
3	2	2	3	2	1	3	4	2	1	3	4
3	2	2	3	2	2	2	2	2	2	2	2
3	2	2	3	2	3	4	5	2	3	4	5
3	2	2	3	2	4	5	1	2	4	5	1
3	3	3	3	3	1	1	2	3	1	1	2
3	3	3	3	3	2	2	3	3	2	2	3
3	3	3	3	3	3	3	3	3	3	3	3
3	3	3	3	3	4	3	4	3	4	3	4
3	4	3	4	3	1	1	2	3	1	1	2
3	4	3	4	3	2	2	3	3	2	2	3
3	4	3	4	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4
4	1	4	5	4	1	4	5	4	1	4	5
4	1	4	5	4	2	5	1	4	2	5	1
4	1	4	5	4	3	1	2	4	3	1	2
4	1	4	5	4	4	4	4	4	4	4	4
4	3	1	2	1	1	1	1	1	1	1	1
4	3	1	2	1	2	5	1	1	2	5	1
4	3	1	2	1	3	1	2	1	3	1	2
4	3	1	2	1	4	2	3	1	4	2	3
4	4	4	4	4	1	4	5	4	1	4	5
4	4	4	4	4	2	5	1	4	2	5	1
4	4	4	4	4	3	1	2	4	3	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select STRAIGHT_JOIN *
FROM (t1 as X CROSS JOIN t1 as Y)
JOIN t1 as Z ON Z.a=X.a and Z.b=Y.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	PRIMARY	NULL	NULL	NULL	16	
1	SIMPLE	Y	ALL	NULL	NULL	NULL	NULL	16	Parent of 2 pushed join@1
1	SIMPLE	Z	eq_ref	PRIMARY	PRIMARY	8	test.X.a,test.Y.b	1	Child of pushed join@1
select STRAIGHT_JOIN *
FROM (t1 as X CROSS JOIN t1 as Y)
JOIN t1 as Z ON Z.a=X.a and Z.b=Y.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	2	5	1	1	2	5	1
1	1	1	1	1	3	1	2	1	3	1	2
1	1	1	1	1	4	2	3	1	4	2	3
1	1	1	1	2	1	3	4	1	1	1	1
1	1	1	1	2	2	2	2	1	2	5	1
1	1	1	1	2	3	4	5	1	3	1	2
1	1	1	1	2	4	5	1	1	4	2	3
1	1	1	1	3	1	1	2	1	1	1	1
1	1	1	1	3	2	2	3	1	2	5	1
1	1	1	1	3	3	3	3	1	3	1	2
1	1	1	1	3	4	3	4	1	4	2	3
1	1	1	1	4	1	4	5	1	1	1	1
1	1	1	1	4	2	5	1	1	2	5	1
1	1	1	1	4	3	1	2	1	3	1	2
1	1	1	1	4	4	4	4	1	4	2	3
1	2	5	1	1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1	1	2	5	1
1	2	5	1	1	3	1	2	1	3	1	2
1	2	5	1	1	4	2	3	1	4	2	3
1	2	5	1	2	1	3	4	1	1	1	1
1	2	5	1	2	2	2	2	1	2	5	1
1	2	5	1	2	3	4	5	1	3	1	2
1	2	5	1	2	4	5	1	1	4	2	3
1	2	5	1	3	1	1	2	1	1	1	1
1	2	5	1	3	2	2	3	1	2	5	1
1	2	5	1	3	3	3	3	1	3	1	2
1	2	5	1	3	4	3	4	1	4	2	3
1	2	5	1	4	1	4	5	1	1	1	1
1	2	5	1	4	2	5	1	1	2	5	1
1	2	5	1	4	3	1	2	1	3	1	2
1	2	5	1	4	4	4	4	1	4	2	3
1	3	1	2	1	1	1	1	1	1	1	1
1	3	1	2	1	2	5	1	1	2	5	1
1	3	1	2	1	3	1	2	1	3	1	2
1	3	1	2	1	4	2	3	1	4	2	3
1	3	1	2	2	1	3	4	1	1	1	1
1	3	1	2	2	2	2	2	1	2	5	1
1	3	1	2	2	3	4	5	1	3	1	2
1	3	1	2	2	4	5	1	1	4	2	3
1	3	1	2	3	1	1	2	1	1	1	1
1	3	1	2	3	2	2	3	1	2	5	1
1	3	1	2	3	3	3	3	1	3	1	2
1	3	1	2	3	4	3	4	1	4	2	3
1	3	1	2	4	1	4	5	1	1	1	1
1	3	1	2	4	2	5	1	1	2	5	1
1	3	1	2	4	3	1	2	1	3	1	2
1	3	1	2	4	4	4	4	1	4	2	3
1	4	2	3	1	1	1	1	1	1	1	1
1	4	2	3	1	2	5	1	1	2	5	1
1	4	2	3	1	3	1	2	1	3	1	2
1	4	2	3	1	4	2	3	1	4	2	3
1	4	2	3	2	1	3	4	1	1	1	1
1	4	2	3	2	2	2	2	1	2	5	1
1	4	2	3	2	3	4	5	1	3	1	2
1	4	2	3	2	4	5	1	1	4	2	3
1	4	2	3	3	1	1	2	1	1	1	1
1	4	2	3	3	2	2	3	1	2	5	1
1	4	2	3	3	3	3	3	1	3	1	2
1	4	2	3	3	4	3	4	1	4	2	3
1	4	2	3	4	1	4	5	1	1	1	1
1	4	2	3	4	2	5	1	1	2	5	1
1	4	2	3	4	3	1	2	1	3	1	2
1	4	2	3	4	4	4	4	1	4	2	3
2	1	3	4	1	1	1	1	2	1	3	4
2	1	3	4	1	2	5	1	2	2	2	2
2	1	3	4	1	3	1	2	2	3	4	5
2	1	3	4	1	4	2	3	2	4	5	1
2	1	3	4	2	1	3	4	2	1	3	4
2	1	3	4	2	2	2	2	2	2	2	2
2	1	3	4	2	3	4	5	2	3	4	5
2	1	3	4	2	4	5	1	2	4	5	1
2	1	3	4	3	1	1	2	2	1	3	4
2	1	3	4	3	2	2	3	2	2	2	2
2	1	3	4	3	3	3	3	2	3	4	5
2	1	3	4	3	4	3	4	2	4	5	1
2	1	3	4	4	1	4	5	2	1	3	4
2	1	3	4	4	2	5	1	2	2	2	2
2	1	3	4	4	3	1	2	2	3	4	5
2	1	3	4	4	4	4	4	2	4	5	1
2	2	2	2	1	1	1	1	2	1	3	4
2	2	2	2	1	2	5	1	2	2	2	2
2	2	2	2	1	3	1	2	2	3	4	5
2	2	2	2	1	4	2	3	2	4	5	1
2	2	2	2	2	1	3	4	2	1	3	4
2	2	2	2	2	2	2	2	2	2	2	2
2	2	2	2	2	3	4	5	2	3	4	5
2	2	2	2	2	4	5	1	2	4	5	1
2	2	2	2	3	1	1	2	2	1	3	4
2	2	2	2	3	2	2	3	2	2	2	2
2	2	2	2	3	3	3	3	2	3	4	5
2	2	2	2	3	4	3	4	2	4	5	1
2	2	2	2	4	1	4	5	2	1	3	4
2	2	2	2	4	2	5	1	2	2	2	2
2	2	2	2	4	3	1	2	2	3	4	5
2	2	2	2	4	4	4	4	2	4	5	1
2	3	4	5	1	1	1	1	2	1	3	4
2	3	4	5	1	2	5	1	2	2	2	2
2	3	4	5	1	3	1	2	2	3	4	5
2	3	4	5	1	4	2	3	2	4	5	1
2	3	4	5	2	1	3	4	2	1	3	4
2	3	4	5	2	2	2	2	2	2	2	2
2	3	4	5	2	3	4	5	2	3	4	5
2	3	4	5	2	4	5	1	2	4	5	1
2	3	4	5	3	1	1	2	2	1	3	4
2	3	4	5	3	2	2	3	2	2	2	2
2	3	4	5	3	3	3	3	2	3	4	5
2	3	4	5	3	4	3	4	2	4	5	1
2	3	4	5	4	1	4	5	2	1	3	4
2	3	4	5	4	2	5	1	2	2	2	2
2	3	4	5	4	3	1	2	2	3	4	5
2	3	4	5	4	4	4	4	2	4	5	1
2	4	5	1	1	1	1	1	2	1	3	4
2	4	5	1	1	2	5	1	2	2	2	2
2	4	5	1	1	3	1	2	2	3	4	5
2	4	5	1	1	4	2	3	2	4	5	1
2	4	5	1	2	1	3	4	2	1	3	4
2	4	5	1	2	2	2	2	2	2	2	2
2	4	5	1	2	3	4	5	2	3	4	5
2	4	5	1	2	4	5	1	2	4	5	1
2	4	5	1	3	1	1	2	2	1	3	4
2	4	5	1	3	2	2	3	2	2	2	2
2	4	5	1	3	3	3	3	2	3	4	5
2	4	5	1	3	4	3	4	2	4	5	1
2	4	5	1	4	1	4	5	2	1	3	4
2	4	5	1	4	2	5	1	2	2	2	2
2	4	5	1	4	3	1	2	2	3	4	5
2	4	5	1	4	4	4	4	2	4	5	1
3	1	1	2	1	1	1	1	3	1	1	2
3	1	1	2	1	2	5	1	3	2	2	3
3	1	1	2	1	3	1	2	3	3	3	3
3	1	1	2	1	4	2	3	3	4	3	4
3	1	1	2	2	1	3	4	3	1	1	2
3	1	1	2	2	2	2	2	3	2	2	3
3	1	1	2	2	3	4	5	3	3	3	3
3	1	1	2	2	4	5	1	3	4	3	4
3	1	1	2	3	1	1	2	3	1	1	2
3	1	1	2	3	2	2	3	3	2	2	3
3	1	1	2	3	3	3	3	3	3	3	3
3	1	1	2	3	4	3	4	3	4	3	4
3	1	1	2	4	1	4	5	3	1	1	2
3	1	1	2	4	2	5	1	3	2	2	3
3	1	1	2	4	3	1	2	3	3	3	3
3	1	1	2	4	4	4	4	3	4	3	4
3	2	2	3	1	1	1	1	3	1	1	2
3	2	2	3	1	2	5	1	3	2	2	3
3	2	2	3	1	3	1	2	3	3	3	3
3	2	2	3	1	4	2	3	3	4	3	4
3	2	2	3	2	1	3	4	3	1	1	2
3	2	2	3	2	2	2	2	3	2	2	3
3	2	2	3	2	3	4	5	3	3	3	3
3	2	2	3	2	4	5	1	3	4	3	4
3	2	2	3	3	1	1	2	3	1	1	2
3	2	2	3	3	2	2	3	3	2	2	3
3	2	2	3	3	3	3	3	3	3	3	3
3	2	2	3	3	4	3	4	3	4	3	4
3	2	2	3	4	1	4	5	3	1	1	2
3	2	2	3	4	2	5	1	3	2	2	3
3	2	2	3	4	3	1	2	3	3	3	3
3	2	2	3	4	4	4	4	3	4	3	4
3	3	3	3	1	1	1	1	3	1	1	2
3	3	3	3	1	2	5	1	3	2	2	3
3	3	3	3	1	3	1	2	3	3	3	3
3	3	3	3	1	4	2	3	3	4	3	4
3	3	3	3	2	1	3	4	3	1	1	2
3	3	3	3	2	2	2	2	3	2	2	3
3	3	3	3	2	3	4	5	3	3	3	3
3	3	3	3	2	4	5	1	3	4	3	4
3	3	3	3	3	1	1	2	3	1	1	2
3	3	3	3	3	2	2	3	3	2	2	3
3	3	3	3	3	3	3	3	3	3	3	3
3	3	3	3	3	4	3	4	3	4	3	4
3	3	3	3	4	1	4	5	3	1	1	2
3	3	3	3	4	2	5	1	3	2	2	3
3	3	3	3	4	3	1	2	3	3	3	3
3	3	3	3	4	4	4	4	3	4	3	4
3	4	3	4	1	1	1	1	3	1	1	2
3	4	3	4	1	2	5	1	3	2	2	3
3	4	3	4	1	3	1	2	3	3	3	3
3	4	3	4	1	4	2	3	3	4	3	4
3	4	3	4	2	1	3	4	3	1	1	2
3	4	3	4	2	2	2	2	3	2	2	3
3	4	3	4	2	3	4	5	3	3	3	3
3	4	3	4	2	4	5	1	3	4	3	4
3	4	3	4	3	1	1	2	3	1	1	2
3	4	3	4	3	2	2	3	3	2	2	3
3	4	3	4	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4
3	4	3	4	4	1	4	5	3	1	1	2
3	4	3	4	4	2	5	1	3	2	2	3
3	4	3	4	4	3	1	2	3	3	3	3
3	4	3	4	4	4	4	4	3	4	3	4
4	1	4	5	1	1	1	1	4	1	4	5
4	1	4	5	1	2	5	1	4	2	5	1
4	1	4	5	1	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	4	4	4	4
4	1	4	5	2	1	3	4	4	1	4	5
4	1	4	5	2	2	2	2	4	2	5	1
4	1	4	5	2	3	4	5	4	3	1	2
4	1	4	5	2	4	5	1	4	4	4	4
4	1	4	5	3	1	1	2	4	1	4	5
4	1	4	5	3	2	2	3	4	2	5	1
4	1	4	5	3	3	3	3	4	3	1	2
4	1	4	5	3	4	3	4	4	4	4	4
4	1	4	5	4	1	4	5	4	1	4	5
4	1	4	5	4	2	5	1	4	2	5	1
4	1	4	5	4	3	1	2	4	3	1	2
4	1	4	5	4	4	4	4	4	4	4	4
4	2	5	1	1	1	1	1	4	1	4	5
4	2	5	1	1	2	5	1	4	2	5	1
4	2	5	1	1	3	1	2	4	3	1	2
4	2	5	1	1	4	2	3	4	4	4	4
4	2	5	1	2	1	3	4	4	1	4	5
4	2	5	1	2	2	2	2	4	2	5	1
4	2	5	1	2	3	4	5	4	3	1	2
4	2	5	1	2	4	5	1	4	4	4	4
4	2	5	1	3	1	1	2	4	1	4	5
4	2	5	1	3	2	2	3	4	2	5	1
4	2	5	1	3	3	3	3	4	3	1	2
4	2	5	1	3	4	3	4	4	4	4	4
4	2	5	1	4	1	4	5	4	1	4	5
4	2	5	1	4	2	5	1	4	2	5	1
4	2	5	1	4	3	1	2	4	3	1	2
4	2	5	1	4	4	4	4	4	4	4	4
4	3	1	2	1	1	1	1	4	1	4	5
4	3	1	2	1	2	5	1	4	2	5	1
4	3	1	2	1	3	1	2	4	3	1	2
4	3	1	2	1	4	2	3	4	4	4	4
4	3	1	2	2	1	3	4	4	1	4	5
4	3	1	2	2	2	2	2	4	2	5	1
4	3	1	2	2	3	4	5	4	3	1	2
4	3	1	2	2	4	5	1	4	4	4	4
4	3	1	2	3	1	1	2	4	1	4	5
4	3	1	2	3	2	2	3	4	2	5	1
4	3	1	2	3	3	3	3	4	3	1	2
4	3	1	2	3	4	3	4	4	4	4	4
4	3	1	2	4	1	4	5	4	1	4	5
4	3	1	2	4	2	5	1	4	2	5	1
4	3	1	2	4	3	1	2	4	3	1	2
4	3	1	2	4	4	4	4	4	4	4	4
4	4	4	4	1	1	1	1	4	1	4	5
4	4	4	4	1	2	5	1	4	2	5	1
4	4	4	4	1	3	1	2	4	3	1	2
4	4	4	4	1	4	2	3	4	4	4	4
4	4	4	4	2	1	3	4	4	1	4	5
4	4	4	4	2	2	2	2	4	2	5	1
4	4	4	4	2	3	4	5	4	3	1	2
4	4	4	4	2	4	5	1	4	4	4	4
4	4	4	4	3	1	1	2	4	1	4	5
4	4	4	4	3	2	2	3	4	2	5	1
4	4	4	4	3	3	3	3	4	3	1	2
4	4	4	4	3	4	3	4	4	4	4	4
4	4	4	4	4	1	4	5	4	1	4	5
4	4	4	4	4	2	5	1	4	2	5	1
4	4	4	4	4	3	1	2	4	3	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0 and t2.b = t1.c
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	func,test.t1.c	1	Using where
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0 and t2.b = t1.c
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4	3	4	3	4
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	3	1	2	3	1	1	2	3	1	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0 and t2.b = t1.c
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b
where t1.a=1 and t1.d=1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	func,test.t1.c	1	Using where
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0 and t2.b = t1.c
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b
where t1.a=1 and t1.d=1;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
explain
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	func	1	Parent of 2 pushed join@1; Using where
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1
select *
from t1
straight_join t1 as t2 on t2.a = t1.b+0
straight_join t1 as t3 on t3.a = t1.b and t3.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	2	5	1	1	2	5	1
1	1	1	1	1	3	1	2	1	3	1	2
1	1	1	1	1	4	2	3	1	4	2	3
1	2	5	1	2	1	3	4	2	1	3	4
1	2	5	1	2	2	2	2	2	2	2	2
1	2	5	1	2	3	4	5	2	3	4	5
1	2	5	1	2	4	5	1	2	4	5	1
1	3	1	2	3	1	1	2	3	1	1	2
1	3	1	2	3	2	2	3	3	2	2	3
1	3	1	2	3	3	3	3	3	3	3	3
1	3	1	2	3	4	3	4	3	4	3	4
1	4	2	3	4	1	4	5	4	1	4	5
1	4	2	3	4	2	5	1	4	2	5	1
1	4	2	3	4	3	1	2	4	3	1	2
1	4	2	3	4	4	4	4	4	4	4	4
2	1	3	4	1	1	1	1	1	1	1	1
2	1	3	4	1	2	5	1	1	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	1	3	4	1	4	2	3	1	4	2	3
2	2	2	2	2	1	3	4	2	1	3	4
2	2	2	2	2	2	2	2	2	2	2	2
2	2	2	2	2	3	4	5	2	3	4	5
2	2	2	2	2	4	5	1	2	4	5	1
2	3	4	5	3	1	1	2	3	1	1	2
2	3	4	5	3	2	2	3	3	2	2	3
2	3	4	5	3	3	3	3	3	3	3	3
2	3	4	5	3	4	3	4	3	4	3	4
2	4	5	1	4	1	4	5	4	1	4	5
2	4	5	1	4	2	5	1	4	2	5	1
2	4	5	1	4	3	1	2	4	3	1	2
2	4	5	1	4	4	4	4	4	4	4	4
3	1	1	2	1	1	1	1	1	1	1	1
3	1	1	2	1	2	5	1	1	2	5	1
3	1	1	2	1	3	1	2	1	3	1	2
3	1	1	2	1	4	2	3	1	4	2	3
3	2	2	3	2	1	3	4	2	1	3	4
3	2	2	3	2	2	2	2	2	2	2	2
3	2	2	3	2	3	4	5	2	3	4	5
3	2	2	3	2	4	5	1	2	4	5	1
3	3	3	3	3	1	1	2	3	1	1	2
3	3	3	3	3	2	2	3	3	2	2	3
3	3	3	3	3	3	3	3	3	3	3	3
3	3	3	3	3	4	3	4	3	4	3	4
3	4	3	4	4	1	4	5	4	1	4	5
3	4	3	4	4	2	5	1	4	2	5	1
3	4	3	4	4	3	1	2	4	3	1	2
3	4	3	4	4	4	4	4	4	4	4	4
4	1	4	5	1	1	1	1	1	1	1	1
4	1	4	5	1	2	5	1	1	2	5	1
4	1	4	5	1	3	1	2	1	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	2	5	1	2	1	3	4	2	1	3	4
4	2	5	1	2	2	2	2	2	2	2	2
4	2	5	1	2	3	4	5	2	3	4	5
4	2	5	1	2	4	5	1	2	4	5	1
4	3	1	2	3	1	1	2	3	1	1	2
4	3	1	2	3	2	2	3	3	2	2	3
4	3	1	2	3	3	3	3	3	3	3	3
4	3	1	2	3	4	3	4	3	4	3	4
4	4	4	4	4	1	4	5	4	1	4	5
4	4	4	4	4	2	5	1	4	2	5	1
4	4	4	4	4	3	1	2	4	3	1	2
4	4	4	4	4	4	4	4	4	4	4	4
CREATE TABLE t1_myisam (
a int NOT NULL,
b int NOT NULL,
c int NOT NULL,
d int NOT NULL,
PRIMARY KEY (`a`,`b`)
) ENGINE=MyISAM;
insert into t1_myisam values
(1,1,1,1), (2,2,1,1), (3,3,1,1), (4,4,1,1);
set ndb_join_pushdown=true;
explain
select *
from t1_myisam as t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
where t1.a=2 and t1.b=2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	const,const	1	Parent of 2 pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	const,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1_myisam as t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
where t1.a=2 and t1.b=2;
a	b	c	d	a	b	c	d	a	b	c	d
2	2	1	1	1	1	1	1	1	1	1	1
drop table t1_myisam;
set ndb_join_pushdown=true;
explain select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.d = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,const	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
where t1.d = 3;
a	b	c	d	a	b	c	d
1	4	2	3	2	3	4	5
3	2	2	3	2	3	4	5
3	3	3	3	3	3	3	3
explain select * 
from t1 
join t1 as t2 on t2.a = t1.c and t2.b = t1.d 
where t1.a > 2 and t1.d = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	4	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,const	1	Child of pushed join@1
select * 
from t1 
join t1 as t2 on t2.a = t1.c and t2.b = t1.d 
where t1.a > 2 and t1.d = 3;
a	b	c	d	a	b	c	d
3	2	2	3	2	3	4	5
3	3	3	3	3	3	3	3
explain select * 
from t1 join t1 as t2 on t2.a = t1.c and t2.b = t1.d 
where t1.d = 3 
order by t1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,const	1	Child of pushed join@1
select * 
from t1 join t1 as t2 on t2.a = t1.c and t2.b = t1.d 
where t1.d = 3 
order by t1.a;
a	b	c	d	a	b	c	d
1	4	2	3	2	3	4	5
3	2	2	3	2	3	4	5
3	3	3	3	3	3	3	3
set ndb_join_pushdown=true;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	test.t1.c	1	Parent of 2 pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	Child of pushed join@1
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	3	1	2	1	2	5	1
1	1	1	1	1	4	2	3	2	3	4	5
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c
left join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	test.t1.c	1	Parent of 2 pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	Child of pushed join@1
select *
from t1
left join t1 as t2 on t2.a = t1.c
left join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	2	5	1	NULL	NULL	NULL	NULL
1	1	1	1	1	3	1	2	1	2	5	1
1	1	1	1	1	4	2	3	2	3	4	5
set ndb_join_pushdown=false;
explain
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	const	10	
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	
select *
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	3	1	2	1	2	5	1
1	1	1	1	1	4	2	3	2	3	4	5
explain
select *
from t1
left join t1 as t2 on t2.a = t1.c
left join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	8	const,const	1	
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	const	10	
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	
select *
from t1
left join t1 as t2 on t2.a = t1.c
left join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t1.a = 1 and t1.b = 1;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	2	5	1	NULL	NULL	NULL	NULL
1	1	1	1	1	3	1	2	1	2	5	1
1	1	1	1	1	4	2	3	2	3	4	5
set ndb_join_pushdown=true;
explain
select *
from t1 as t2
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t2.a = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	Child of pushed join@1
select *
from t1 as t2
join t1 as t3 on t3.a = t2.c and t3.b = t2.d
where t2.a = 1;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	3	1	2	1	2	5	1
1	4	2	3	2	3	4	5
set ndb_join_pushdown=true;
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t2.c and t3.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t1.c	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t2.c and t3.b = t1.c;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	1	3	1	2	1	1	1	1
1	4	2	3	1	4	2	3	2	2	2	2
2	1	3	4	2	1	3	4	3	3	3	3
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	2	3	4	5	4	4	4	4
3	1	1	2	3	1	1	2	1	1	1	1
3	2	2	3	3	2	2	3	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	3	3	3
4	1	4	5	4	1	4	5	4	4	4	4
4	3	1	2	4	3	1	2	1	1	1	1
4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t2.c	1	
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.c;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	2	5	1
2	1	3	4	2	1	3	4	3	4	3	4	3	3	3	3
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	2	5	1
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	3	3	3
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t2.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t2.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t2.c	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t2.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.c;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	2	5	1
2	1	3	4	2	1	3	4	3	4	3	4	3	3	3	3
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	2	5	1
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	3	3	3
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t2.d
join t1 as t4 on t4.a = t3.c and t4.b = t1.d;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t2.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t1.d	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t2.d
join t1 as t4 on t4.a = t3.c and t4.b = t1.d;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	3	1	2
2	1	3	4	2	1	3	4	3	4	3	4	3	4	3	4
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	3	1	2
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	4	3	4
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.a and t4.b = t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t2.c	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.a and t4.b = t2.c;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	1	3	1	2	1	2	5	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	2	2	2	2
2	1	3	4	2	1	3	4	3	4	3	4	3	3	3	3
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	1	1	2	3	1	1	2	1	2	5	1	1	1	1	1
3	2	2	3	3	2	2	3	2	3	4	5	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	3	3	3
4	3	1	2	4	3	1	2	1	2	5	1	1	1	1	1
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.b and t4.b = t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t1.d,test.t2.c	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.b and t4.b = t2.c;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	1	3	1	2	1	2	5	1	2	1	3	4
1	4	2	3	1	4	2	3	2	3	4	5	3	2	2	3
2	1	3	4	2	1	3	4	3	4	3	4	4	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	1	1	2	3	1	1	2	1	2	5	1	2	1	3	4
3	2	2	3	3	2	2	3	2	3	4	5	3	2	2	3
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	4	3	1	2
4	3	1	2	4	3	1	2	1	2	5	1	2	1	3	4
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t1.a	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.a;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	1	4	5
2	1	3	4	2	1	3	4	3	4	3	4	3	2	2	3
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	3	1	2
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	3	3	3
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t1.b	1	Child of pushed join@1
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t2.b;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	4	4	4
2	1	3	4	2	1	3	4	3	4	3	4	3	1	1	2
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	2	5	1
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	4	3	4
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t1.c and t4.b = t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.a,test.t2.c	1	Child of pushed join@1; Using where
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t1.c and t4.b = t2.c;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	1	3	1	2	1	2	5	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	2	2	2	2
2	1	3	4	2	1	3	4	3	4	3	4	3	3	3	3
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	1	1	2	3	1	1	2	1	2	5	1	1	1	1	1
3	2	2	3	3	2	2	3	2	3	4	5	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	3	3	3
4	3	1	2	4	3	1	2	1	2	5	1	1	1	1	1
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.a,test.t1.b	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.c,test.t1.d	1	Child of pushed join@1
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	8	test.t3.c,test.t2.b	1	Child of pushed join@1; Using where
select straight_join *
from t1
join t1 as t2 on t2.a = t1.a and t2.b = t1.b
join t1 as t3 on t3.a = t1.c and t3.b = t1.d
join t1 as t4 on t4.a = t3.c and t4.b = t1.b;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	4	2	3	1	4	2	3	2	3	4	5	4	4	4	4
2	1	3	4	2	1	3	4	3	4	3	4	3	1	1	2
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	3	2	2	3	2	3	4	5	4	2	5	1
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	3	4	3	4	3	4	3	4	3	4	3	4
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
set ndb_join_pushdown=true;
explain 
select * from t1 x, t1 y, t1 z, t1 where 
y.a=x.d and y.b=x.b and 
z.a=y.d and 
t1.a = z.d and t1.b=z.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	16	Parent of 4 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
1	SIMPLE	z	ref	PRIMARY	PRIMARY	4	test.y.d	1	Child of pushed join@1
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	8	test.z.d,test.z.b	1	Child of pushed join@1
select * from t1 x, t1 y, t1 z, t1 where 
y.a=x.d and y.b=x.b and 
z.a=y.d and 
t1.a = z.d and t1.b=z.b;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1
1	1	1	1	1	1	1	1	1	2	5	1	1	2	5	1
1	1	1	1	1	1	1	1	1	3	1	2	2	3	4	5
1	1	1	1	1	1	1	1	1	4	2	3	3	4	3	4
1	2	5	1	1	2	5	1	1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1	1	2	5	1	1	2	5	1
1	2	5	1	1	2	5	1	1	3	1	2	2	3	4	5
1	2	5	1	1	2	5	1	1	4	2	3	3	4	3	4
1	4	2	3	3	4	3	4	4	2	5	1	1	2	5	1
1	4	2	3	3	4	3	4	4	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4	4	4	4	4	4	4	4	4
2	2	2	2	2	2	2	2	2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2	2	2	2	2	2	2	2	2
2	2	2	2	2	2	2	2	2	4	5	1	1	4	2	3
2	4	5	1	1	4	2	3	3	1	1	2	2	1	3	4
2	4	5	1	1	4	2	3	3	2	2	3	3	2	2	3
2	4	5	1	1	4	2	3	3	3	3	3	3	3	3	3
2	4	5	1	1	4	2	3	3	4	3	4	4	4	4	4
3	1	1	2	2	1	3	4	4	2	5	1	1	2	5	1
3	1	1	2	2	1	3	4	4	3	1	2	2	3	4	5
3	1	1	2	2	1	3	4	4	4	4	4	4	4	4	4
3	2	2	3	3	2	2	3	3	1	1	2	2	1	3	4
3	2	2	3	3	2	2	3	3	2	2	3	3	2	2	3
3	2	2	3	3	2	2	3	3	3	3	3	3	3	3	3
3	2	2	3	3	2	2	3	3	4	3	4	4	4	4	4
3	3	3	3	3	3	3	3	3	1	1	2	2	1	3	4
3	3	3	3	3	3	3	3	3	2	2	3	3	2	2	3
3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3
3	3	3	3	3	3	3	3	3	4	3	4	4	4	4	4
3	4	3	4	4	4	4	4	4	2	5	1	1	2	5	1
3	4	3	4	4	4	4	4	4	3	1	2	2	3	4	5
3	4	3	4	4	4	4	4	4	4	4	4	4	4	4	4
4	2	5	1	1	2	5	1	1	1	1	1	1	1	1	1
4	2	5	1	1	2	5	1	1	2	5	1	1	2	5	1
4	2	5	1	1	2	5	1	1	3	1	2	2	3	4	5
4	2	5	1	1	2	5	1	1	4	2	3	3	4	3	4
4	4	4	4	4	4	4	4	4	2	5	1	1	2	5	1
4	4	4	4	4	4	4	4	4	3	1	2	2	3	4	5
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4
explain 
select * from t1 x, t1 y where
x.a <= 2 and
y.a=x.d and y.b=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	range	PRIMARY	PRIMARY	4	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
select * from t1 x, t1 y where
x.a <= 2 and
y.a=x.d and y.b=x.b;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1
1	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4
2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2
2	4	5	1	1	4	2	3
explain 
select * from t1 x, t1 y where
(x.a <= 2 or x.a > 3) and
y.a=x.d and y.b=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	range	PRIMARY	PRIMARY	4	NULL	20	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
select * from t1 x, t1 y where
(x.a <= 2 or x.a > 3) and
y.a=x.d and y.b=x.b;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1
1	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4
2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2
2	4	5	1	1	4	2	3
4	2	5	1	1	2	5	1
4	3	1	2	2	3	4	5
4	4	4	4	4	4	4	4
explain 
select * from t1 x, t1 y where
(x.a >= 2 or x.a < 3) and
y.a=x.d and y.b=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	range	PRIMARY	PRIMARY	4	NULL	20	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
select * from t1 x, t1 y where
(x.a >= 2 or x.a < 3) and
y.a=x.d and y.b=x.b;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1
1	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4
2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2
2	4	5	1	1	4	2	3
3	1	1	2	2	1	3	4
3	2	2	3	3	2	2	3
3	3	3	3	3	3	3	3
3	4	3	4	4	4	4	4
4	2	5	1	1	2	5	1
4	3	1	2	2	3	4	5
4	4	4	4	4	4	4	4
explain 
select * from t1 x, t1 y where
(x.a <= 2 or x.a in (0,5,4)) and
y.a=x.d and y.b=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	range	PRIMARY	PRIMARY	4	NULL	50	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
select * from t1 x, t1 y where
(x.a <= 2 or x.a in (0,5,4)) and
y.a=x.d and y.b=x.b;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1
1	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4
2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2
2	4	5	1	1	4	2	3
4	2	5	1	1	2	5	1
4	3	1	2	2	3	4	5
4	4	4	4	4	4	4	4
explain 
select * from t1 x, t1 y where
(x.a <= 2 or (x.a,x.b) in ((0,0),(5,0),(4,3))) and
y.a=x.d and y.b=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	PRIMARY	NULL	NULL	NULL	16	Parent of 2 pushed join@1; Using where
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d,test.x.b	1	Child of pushed join@1
select * from t1 x, t1 y where
(x.a <= 2 or (x.a,x.b) in ((0,0),(5,0),(4,3))) and
y.a=x.d and y.b=x.b;
a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1
1	2	5	1	1	2	5	1
1	3	1	2	2	3	4	5
1	4	2	3	3	4	3	4
2	1	3	4	4	1	4	5
2	2	2	2	2	2	2	2
2	4	5	1	1	4	2	3
4	3	1	2	2	3	4	5
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.c,t1.d,
t1.a, t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.c,t1.d,
t1.a, t1.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
3	1	1	2	1	1	1	1	1	1	1	1
4	3	1	2	3	1	1	2	3	1	1	2
2	2	2	2	2	2	2	2	2	2	2	2
1	4	2	3	4	2	5	1	4	2	5	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
2	1	3	4	1	3	1	2	1	3	1	2
3	4	3	4	4	3	1	2	4	3	1	2
4	4	4	4	4	4	4	4	4	4	4	4
2	3	4	5	3	4	3	4	3	4	3	4
4	1	4	5	1	4	2	3	1	4	2	3
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.c,t2.d,
t1.a, t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.c,t2.d,
t1.a, t1.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
3	1	1	2	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
4	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	2	2	2	2	2	2	2	2
2	1	3	4	1	3	1	2	1	3	1	2
3	4	3	4	4	3	1	2	4	3	1	2
3	3	3	3	3	3	3	3	3	3	3	3
4	1	4	5	1	4	2	3	1	4	2	3
2	3	4	5	3	4	3	4	3	4	3	4
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a,t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a,t1.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	1	3	4	1	3	1	2	1	3	1	2
2	2	2	2	2	2	2	2	2	2	2	2
2	3	4	5	3	4	3	4	3	4	3	4
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	3	1	2	3	1	1	2	3	1	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a,t2.b,
t1.a, t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a,t2.b,
t1.a, t1.b;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
1	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
2	2	2	2	2	2	2	2	2	2	2	2
2	1	3	4	1	3	1	2	1	3	1	2
2	3	4	5	3	4	3	4	3	4	3	4
3	1	1	2	1	1	1	1	1	1	1	1
3	2	2	3	2	2	2	2	2	2	2	2
3	3	3	3	3	3	3	3	3	3	3	3
3	4	3	4	4	3	1	2	4	3	1	2
4	3	1	2	3	1	1	2	3	1	1	2
4	1	4	5	1	4	2	3	1	4	2	3
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a desc,t1.b desc;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a desc,t1.b desc;
a	b	c	d	a	b	c	d	a	b	c	d
4	4	4	4	4	4	4	4	4	4	4	4
4	3	1	2	3	1	1	2	3	1	1	2
4	1	4	5	1	4	2	3	1	4	2	3
3	4	3	4	4	3	1	2	4	3	1	2
3	3	3	3	3	3	3	3	3	3	3	3
3	2	2	3	2	2	2	2	2	2	2	2
3	1	1	2	1	1	1	1	1	1	1	1
2	3	4	5	3	4	3	4	3	4	3	4
2	2	2	2	2	2	2	2	2	2	2	2
2	1	3	4	1	3	1	2	1	3	1	2
1	4	2	3	4	2	5	1	4	2	5	1
1	3	1	2	3	1	1	2	3	1	1	2
1	1	1	1	1	1	1	1	1	1	1	1
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.b,t1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.b,t1.a;
a	b	c	d	a	b	c	d	a	b	c	d
1	1	1	1	1	1	1	1	1	1	1	1
2	1	3	4	1	3	1	2	1	3	1	2
3	1	1	2	1	1	1	1	1	1	1	1
4	1	4	5	1	4	2	3	1	4	2	3
2	2	2	2	2	2	2	2	2	2	2	2
3	2	2	3	2	2	2	2	2	2	2	2
1	3	1	2	3	1	1	2	3	1	1	2
2	3	4	5	3	4	3	4	3	4	3	4
3	3	3	3	3	3	3	3	3	3	3	3
4	3	1	2	3	1	1	2	3	1	1	2
1	4	2	3	4	2	5	1	4	2	5	1
3	4	3	4	4	3	1	2	4	3	1	2
4	4	4	4	4	4	4	4	4	4	4	4
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
explain
select *
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
order by t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
explain
select t1.a, t1.b, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.a, t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select t1.a, t1.b, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.a, t1.b;
a	b	count(*)
1	1	1
1	3	1
1	4	1
2	1	1
2	2	1
2	3	1
3	1	1
3	2	1
3	3	1
3	4	1
4	1	1
4	3	1
4	4	1
explain
select t1.a, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	8	NULL	16	Parent of 3 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select t1.a, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.a;
a	count(*)
1	3
2	3
3	4
4	3
explain
select t1.b, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	16	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t1.c	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	8	test.t1.b,test.t2.b	1	Child of pushed join@1; Using where
select t1.b, count(*)
from t1
join t1 as t2 on t2.a = t1.b and t2.b = t1.c
join t1 as t3 on t3.a = t2.a and t3.b = t2.b
group by t1.b;
b	count(*)
1	4
2	2
3	4
4	3
explain
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4 and t2.b=4
group by t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	const	PRIMARY	PRIMARY	8	const,const	1	Using where; Using filesort
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4 and t2.b=4
group by t2.c;
c	count(distinct t2.a)
4	1
explain
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4
group by t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	const	10	Using where; Using filesort
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4
group by t2.c;
c	count(distinct t2.a)
1	1
4	1
explain
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4 and t2.b=4
group by t2.c order by t2.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	const	PRIMARY	PRIMARY	8	const,const	1	Using where; Using filesort
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	8	test.t2.c,test.t2.d	1	
select t2.c, count(distinct t2.a)
from t1
join t1 as t2 on t1.a = t2.c and t1.b = t2.d
where t2.a = 4 and t2.b=4
group by t2.c order by t2.c;
c	count(distinct t2.a)
4	1
drop table t1;
create table t1 (a int, b int, primary key(a) using hash) engine = ndb;
insert into t1 values (1, 2);
insert into t1 values (2, 3);
insert into t1 values (3, 1);
set ndb_join_pushdown=true;
explain
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	4	NULL	3	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b;
a	b	a	b
1	2	2	3
3	1	1	2
drop table t1;
create table t1 (a int, b int, primary key(a)) engine = ndb;
insert into t1 values (1, 2);
insert into t1 values (2, 3);
insert into t1 values (3, 1);
set ndb_join_pushdown=true;
explain
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	4	NULL	3	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b;
a	b	a	b
1	2	2	3
3	1	1	2
explain
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b
order by t1.a desc;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	4	NULL	3	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select *
from t1, t1 as t2
where t1.a in (1,3,5)
and t2.a = t1.b
order by t1.a desc;
a	b	a	b
3	1	1	2
1	2	2	3
drop table t1;
set ndb_join_pushdown=true;
create table t1 (a int, b int, primary key(a)) engine = ndb;
insert into t1 values (0x1f, 0x2f);
insert into t1 values (0x2f, 0x3f);
insert into t1 values (0x3f, 0x1f);
create table t2 (c int, d int, primary key(c)) engine = ndb;
insert into t2 values (0x1f, 0x2f);
insert into t2 values (0x2f, 0x3f);
insert into t2 values (0x3f, 0x1f);
create table t3 (a3 int, b3 int, c3 int not null, d3 int not null,
primary key(a3, b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
create table t3_hash (a3 int, b3 int, c3 int not null, d3 int not null,
primary key(a3, b3) using hash) engine = ndb;
insert into t3_hash values (0x1f, 0x2f, 1, 0x1f);
insert into t3_hash values (0x2f, 0x3f, 2, 0x2f);
insert into t3_hash values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y, t1 where y.a3=x.d3 and y.b3=x.b3 and t1.a = y.d3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 3 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,test.x.b3	1	Child of pushed join@1
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.y.d3	1	Child of pushed join@1
select * from t3 x, t3 y, t1 where y.a3=x.d3 and y.b3=x.b3 and t1.a = y.d3;
a3	b3	c3	d3	a3	b3	c3	d3	a	b
31	47	1	31	31	47	1	31	31	47
47	63	2	47	47	63	2	47	47	63
63	31	3	63	63	31	3	63	63	31
explain
select *
from t3 x, t3 y, t3 z, t3 z2, t1
where y.a3=x.d3 and y.b3=x.b3 and
z.a3=y.d3 and z.b3=y.b3 and
z2.a3=z.d3 and z2.b3=z.b3 and
t1.a = z2.d3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 5 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,test.x.b3	1	Child of pushed join@1
1	SIMPLE	z	eq_ref	PRIMARY	PRIMARY	8	test.y.d3,test.x.b3	1	Child of pushed join@1
1	SIMPLE	z2	eq_ref	PRIMARY	PRIMARY	8	test.z.d3,test.y.b3	1	Child of pushed join@1; Using where
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.z2.d3	1	Child of pushed join@1
select *
from t3 x, t3 y, t3 z, t3 z2, t1
where y.a3=x.d3 and y.b3=x.b3 and
z.a3=y.d3 and z.b3=y.b3 and
z2.a3=z.d3 and z2.b3=z.b3 and
t1.a = z2.d3;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3	a	b
31	47	1	31	31	47	1	31	31	47	1	31	31	47	1	31	31	47
47	63	2	47	47	63	2	47	47	63	2	47	47	63	2	47	47	63
63	31	3	63	63	31	3	63	63	31	3	63	63	31	3	63	63	31
explain
select straight_join * from t1 x, t1 y where y.a=0x1f and x.b = 0x1f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Using where with pushed condition
1	SIMPLE	y	const	PRIMARY	PRIMARY	4	const	1	
select straight_join * from t1 x, t1 y where y.a=0x1f and x.b = 0x1f;
a	b	a	b
63	31	31	47
explain
select straight_join * from t1 x, t1 y where y.a=x.b and x.b = 0x1f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Using where with pushed condition
1	SIMPLE	y	const	PRIMARY	PRIMARY	4	const	1	Using where
select straight_join * from t1 x, t1 y where y.a=x.b and x.b = 0x1f;
a	b	a	b
63	31	31	47
create unique index t3_d3 on t3(d3);
create unique index t3_d3 on t3_hash(d3);
commit;
explain
select * from t3 x, t3 y where x.d3=31 and y.a3=x.d3 and y.b3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	const	t3_d3	t3_d3	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	const,test.x.b3	1	Child of pushed join@1
select * from t3 x, t3 y where x.d3=31 and y.a3=x.d3 and y.b3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
explain
select * from t3 x, t3 y where x.d3=0 and y.a3=x.d3 and y.b3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	const	t3_d3	t3_d3	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	const,test.x.b3	1	Child of pushed join@1
select * from t3 x, t3 y where x.d3=0 and y.a3=x.d3 and y.b3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
explain
select * from t1 x, t3 y where y.d3=x.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	t3_d3	t3_d3	4	test.x.b	1	Child of pushed join@1
select * from t1 x, t3 y where y.d3=x.b;
a	b	a3	b3	c3	d3
31	47	47	63	2	47
47	63	63	31	3	63
63	31	31	47	1	31
explain
select * from t3 x, t3 y where x.d3=31 and y.d3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	const	t3_d3	t3_d3	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	t3_d3	t3_d3	4	test.x.b3	1	Child of pushed join@1
select * from t3 x, t3 y where x.d3=31 and y.d3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	47	63	2	47
explain
select * from t3 x, t3 y where x.d3=31 and y.d3=x.c3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	const	t3_d3	t3_d3	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	t3_d3	t3_d3	4	test.x.c3	1	Child of pushed join@1
select * from t3 x, t3 y where x.d3=31 and y.d3=x.c3;
a3	b3	c3	d3	a3	b3	c3	d3
explain
select * from t3 x, t3 y 
where ((x.a3=0x2f and x.b3=0x3f) or x.d3=0x1f)
and  (y.a3=x.d3 and y.b3=x.b3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	index_merge	PRIMARY,t3_d3	t3_d3,PRIMARY	4,8	NULL	2	Parent of 2 pushed join@1; Using sort_union(t3_d3,PRIMARY); Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,test.x.b3	1	Child of pushed join@1
select * from t3 x, t3 y
where ((x.a3=0x2f and x.b3=0x3f) or x.d3=0x1f)
and  (y.a3=x.d3 and y.b3=x.b3);
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
explain
select * from t3_hash x, t3_hash y
where ((x.a3=0x2f and x.b3=0x3f) or x.d3=0x1f)
and  (y.a3=x.d3 and y.b3=x.b3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	index_merge	PRIMARY,t3_d3	PRIMARY,t3_d3	8,4	NULL	2	Parent of 2 pushed join@1; Using sort_union(PRIMARY,t3_d3); Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,test.x.b3	1	Child of pushed join@1
select * from t3_hash x, t3_hash y
where ((x.a3=0x2f and x.b3=0x3f) or x.d3=0x1f)
and  (y.a3=x.d3 and y.b3=x.b3);
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
explain
select * from t3 x, t3 y where x.d3>=31 and y.d3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	range	t3_d3	t3_d3	4	NULL	1	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	t3_d3	t3_d3	4	test.x.b3	1	Child of pushed join@1
select * from t3 x, t3 y where x.d3>=31 and y.d3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	47	63	2	47
47	63	2	47	63	31	3	63
63	31	3	63	31	47	1	31
insert into t1 values (0x4f, null);
select * from t1 left join t1 as t2 on t2.a = t1.b;
a	b	a	b
31	47	47	63
47	63	63	31
63	31	31	47
79	NULL	NULL	NULL
drop table t1,t2,t3, t3_hash;
create table t3 (a3 int, b3 int, c3 int, d3 int,
primary key(b3, a3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
create table t3_hash (a3 int, b3 int, c3 int, d3 int,
primary key(b3,a3) using hash) engine = ndb;
insert into t3_hash values (0x1f, 0x2f, 1, 0x1f);
insert into t3_hash values (0x2f, 0x3f, 2, 0x2f);
insert into t3_hash values (0x3f, 0x1f, 3, 0x3f);
create table t3_unq (pk int, a3 int not null, b3 int not null, c3 int, d3 int,
primary key(pk) using hash, unique key(b3,a3) using hash) engine = ndb;
insert into t3_unq values (1001, 0x1f, 0x2f, 1, 0x1f);
insert into t3_unq values (1002, 0x2f, 0x3f, 2, 0x2f);
insert into t3_unq values (1003, 0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where y.a3=x.d3 and y.b3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	PRIMARY	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.b3,test.x.d3	1	Child of pushed join@1
select * from t3 x, t3 y where y.a3=x.d3 and y.b3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63
explain
select * from t3_hash x, t3_hash y where y.a3=x.d3 and y.b3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	PRIMARY	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.b3,test.x.d3	1	Child of pushed join@1
select * from t3_hash x, t3_hash y where y.a3=x.d3 and y.b3=x.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63
explain
select * from t3_unq x, t3_unq y where y.a3=x.d3 and y.b3=x.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	b3	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	b3	b3	8	test.x.b3,test.x.d3	1	Child of pushed join@1
select * from t3_unq x, t3_unq y where y.a3=x.d3 and y.b3=x.b3;
pk	a3	b3	c3	d3	pk	a3	b3	c3	d3
1001	31	47	1	31	1001	31	47	1	31
1002	47	63	2	47	1002	47	63	2	47
1003	63	31	3	63	1003	63	31	3	63
drop table t3, t3_hash, t3_unq;
create table t3 (a3 int, b3 int, c3 int, d3 int,
primary key(a3), unique key(d3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
insert into t3 values (0x4f, 0,    NULL, NULL);
explain
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.d3
left outer join t3 as t3 on t3.a3 = t2.d3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	Parent of 3 pushed join@1
1	SIMPLE	t2	ref	d3	d3	5	test.t1.d3	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.d3	1	Child of pushed join@1
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.d3
left outer join t3 as t3 on t3.a3 = t2.d3;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63	63	31	3	63
79	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
explain
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 = 47;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ref	d3	d3	5	const	1	Parent of 3 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	ref	d3	d3	5	test.t1.a3	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.d3	1	Child of pushed join@1
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 = 47;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47	47	63	2	47
explain
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 >= 47;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	d3	d3	5	NULL	1	Parent of 3 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	ref	d3	d3	5	test.t1.a3	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.d3	1	Child of pushed join@1
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 >= 47;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63	63	31	3	63
explain
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 is NULL;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ref	d3	d3	5	const	1	Parent of 3 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	ref	d3	d3	5	test.t1.a3	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.d3	1	Child of pushed join@1
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 is NULL;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
79	0	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
explain
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 is not NULL;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	d3	d3	5	NULL	1	Parent of 3 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	ref	d3	d3	5	test.t1.a3	1	Child of pushed join@1
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.d3	1	Child of pushed join@1
select * from t3 as t1
left outer join t3 as t2 on t2.d3 = t1.a3
left outer join t3 as t3 on t3.a3 = t2.d3
where t1.d3 is not NULL;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63	63	31	3	63
drop table t3;
create table t3 (a3 int not null, b3 int not null, c3 int, d3 int,
primary key(a3), unique key(b3,d3), unique key(c3,b3), unique key(c3,d3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1,    0x1f);
insert into t3 values (0x2f, 0x3f, 2,    0x2f);
insert into t3 values (0x3f, 0x1f, 3,    0x3f);
insert into t3 values (0x40, 0,    NULL, NULL);
insert into t3 values (0x41, 0,    NULL, NULL);
insert into t3 values (0x42, 0,    4,    NULL);
insert into t3 values (0x43, 0,    NULL, 0x43);
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	4	test.X.b3	1	Child of pushed join@1
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63
64	0	NULL	NULL	64	0	NULL	NULL
64	0	NULL	NULL	65	0	NULL	NULL
64	0	NULL	NULL	66	0	4	NULL
64	0	NULL	NULL	67	0	NULL	67
65	0	NULL	NULL	64	0	NULL	NULL
65	0	NULL	NULL	65	0	NULL	NULL
65	0	NULL	NULL	66	0	4	NULL
65	0	NULL	NULL	67	0	NULL	67
66	0	4	NULL	64	0	NULL	NULL
66	0	4	NULL	65	0	NULL	NULL
66	0	4	NULL	66	0	4	NULL
66	0	4	NULL	67	0	NULL	67
67	0	NULL	67	64	0	NULL	NULL
67	0	NULL	67	65	0	NULL	NULL
67	0	NULL	67	66	0	4	NULL
67	0	NULL	67	67	0	NULL	67
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 = 0x2f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 = 0x2f;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.d3 = 0x2f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	c3,c3_2	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	c3,c3_2	c3	5	test.X.c3	1	Child of pushed join@1; Using where with pushed condition
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.d3 = 0x2f;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.d3 = Y.d3
where Y.b3 = 0x2f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	NULL	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	const,test.X.d3	1	Child of pushed join@1; Using where
select straight_join * 
from t3 as X JOIN t3 as Y on X.d3 = Y.d3
where Y.b3 = 0x2f;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.d3 = Y.d3
where Y.b3 = 0x20+0x2f;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	NULL	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	const,test.X.d3	1	Child of pushed join@1; Using where
select straight_join * 
from t3 as X JOIN t3 as Y on X.d3 = Y.d3
where Y.b3 = 0x20+0x2f;
a3	b3	c3	d3	a3	b3	c3	d3
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 is not NULL;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	4	test.X.b3	1	Child of pushed join@1; Using where with pushed condition
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 is not NULL;
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	31	47	1	31
47	63	2	47	47	63	2	47
63	31	3	63	63	31	3	63
64	0	NULL	NULL	67	0	NULL	67
65	0	NULL	NULL	67	0	NULL	67
66	0	4	NULL	67	0	NULL	67
67	0	NULL	67	67	0	NULL	67
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 is NULL;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Using where with pushed condition
select straight_join * 
from t3 as X JOIN t3 as Y on X.b3 = Y.b3
where Y.d3 is NULL;
a3	b3	c3	d3	a3	b3	c3	d3
64	0	NULL	NULL	64	0	NULL	NULL
64	0	NULL	NULL	65	0	NULL	NULL
64	0	NULL	NULL	66	0	4	NULL
65	0	NULL	NULL	64	0	NULL	NULL
65	0	NULL	NULL	65	0	NULL	NULL
65	0	NULL	NULL	66	0	4	NULL
66	0	4	NULL	64	0	NULL	NULL
66	0	4	NULL	65	0	NULL	NULL
66	0	4	NULL	66	0	4	NULL
67	0	NULL	67	64	0	NULL	NULL
67	0	NULL	67	65	0	NULL	NULL
67	0	NULL	67	66	0	4	NULL
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.b3 = 0;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	c3,c3_2	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3,c3,c3_2	c3	9	test.X.c3,const	1	Child of pushed join@1; Using where
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.b3 = 0;
a3	b3	c3	d3	a3	b3	c3	d3
66	0	4	NULL	66	0	4	NULL
explain
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.b3 is NULL;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE
select straight_join * 
from t3 as X JOIN t3 as Y on X.c3 = Y.c3
where Y.b3 is NULL;
a3	b3	c3	d3	a3	b3	c3	d3
explain
select straight_join * from
t3 as X1
JOIN t3 as Y1 on X1.b3 = Y1.b3 and X1.d3 = Y1.d3
JOIN t3 as X2 on X2.b3 = Y1.b3
JOIN t3 as Y2 on Y2.b3 = X2.c3 and Y2.d3 = X1.c3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X1	ALL	b3,c3,c3_2	NULL	NULL	NULL	7	Parent of 4 pushed join@1
1	SIMPLE	Y1	ref	b3	b3	9	test.X1.b3,test.X1.d3	1	Child of pushed join@1; Using where
1	SIMPLE	X2	ref	b3,c3,c3_2	b3	4	test.X1.b3	1	Child of pushed join@1
1	SIMPLE	Y2	ref	b3	b3	9	test.X2.c3,test.X1.c3	1	Child of pushed join@1; Using where
select straight_join * from
t3 as X1
JOIN t3 as Y1 on X1.b3 = Y1.b3 and X1.d3 = Y1.d3
JOIN t3 as X2 on X2.b3 = Y1.b3
JOIN t3 as Y2 on Y2.b3 = X2.c3 and Y2.d3 = X1.c3;
a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3	a3	b3	c3	d3
prepare stmt1 from
'select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = 0x2f';
execute stmt1;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
execute stmt1;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop prepare stmt1;
execute stmt1;
ERROR HY000: Unknown prepared statement handler (stmt1) given to EXECUTE
prepare stmt1 from
'select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = 0x2f';
prepare stmt1 from
'select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = 0x2f';
drop prepare stmt1;
prepare stmt1 from
'explain select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = 0x2f';
execute stmt1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
execute stmt1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
commit;
execute stmt1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
drop index b3 on t3;
execute stmt1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	NULL	NULL	NULL	NULL	7	
1	SIMPLE	Y	ALL	NULL	NULL	NULL	NULL	7	Using where with pushed condition; Using join buffer
create unique index b3 on t3(b3,d3);
execute stmt1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
drop prepare stmt1;
prepare stmt1 from
'explain select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = ?';
set @a=47;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
set @a=0;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Child of pushed join@1; Using where with pushed condition
set @a=NULL;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	ALL	b3	NULL	NULL	NULL	7	
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,const	1	Using where
prepare stmt1 from
'select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3
  where Y.d3 = ?';
set @a=47;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
set @a=0;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
set @a=NULL;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
prepare stmt1 from
'explain select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3 and X.d3 = Y.d3
  where X.a3 = ?';
set @a=47;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	const	PRIMARY,b3	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,test.X.d3	1	Child of pushed join@1; Using where
set @a=0;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	X	const	PRIMARY,b3	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	Y	ref	b3	b3	9	test.X.b3,test.X.d3	1	Child of pushed join@1; Using where
set @a=NULL;
execute stmt1 using @a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE noticed after reading const tables
prepare stmt1 from
'select straight_join * 
  from t3 as X JOIN t3 as Y on X.b3 = Y.b3 and X.d3 = Y.d3
  where X.a3 = ?';
set @a=47;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
set @a=0;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
set @a=NULL;
execute stmt1 using @a;
a3	b3	c3	d3	a3	b3	c3	d3
drop table t3;
set @a=47;
execute stmt1 using @a;
ERROR 42S02: Table 'test.t3' doesn't exist
create table t1 (a int primary key, b int, c int, index(b,c)) engine = ndb;
insert into t1 values (1,null, 2);
insert into t1 values (2,1, null);
insert into t1 values (3,2,2);
insert into t1 values (4,null, 2);
insert into t1 values (5,1, null);
insert into t1 values (6,2,2);
analyze table t1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	OK
set ndb_join_pushdown=false;
select *
from t1
join t1 as t2 on (t2.b = t1.b or t2.b = t1.a)
join t1 as t3 on t3.a = t2.a
join t1 as t4 on t4.a = t3.b
;
a	b	c	a	b	c	a	b	c	a	b	c
1	NULL	2	2	1	NULL	2	1	NULL	1	NULL	2
1	NULL	2	5	1	NULL	5	1	NULL	1	NULL	2
2	1	NULL	2	1	NULL	2	1	NULL	1	NULL	2
2	1	NULL	3	2	2	3	2	2	2	1	NULL
2	1	NULL	5	1	NULL	5	1	NULL	1	NULL	2
2	1	NULL	6	2	2	6	2	2	2	1	NULL
3	2	2	3	2	2	3	2	2	2	1	NULL
3	2	2	6	2	2	6	2	2	2	1	NULL
5	1	NULL	2	1	NULL	2	1	NULL	1	NULL	2
5	1	NULL	5	1	NULL	5	1	NULL	1	NULL	2
6	2	2	3	2	2	3	2	2	2	1	NULL
6	2	2	6	2	2	6	2	2	2	1	NULL
set ndb_join_pushdown=true;
select *
from t1
join t1 as t2 on (t2.b = t1.b or t2.b = t1.a)
join t1 as t3 on t3.a = t2.a
join t1 as t4 on t4.a = t3.b
;
a	b	c	a	b	c	a	b	c	a	b	c
1	NULL	2	2	1	NULL	2	1	NULL	1	NULL	2
1	NULL	2	5	1	NULL	5	1	NULL	1	NULL	2
2	1	NULL	2	1	NULL	2	1	NULL	1	NULL	2
2	1	NULL	3	2	2	3	2	2	2	1	NULL
2	1	NULL	5	1	NULL	5	1	NULL	1	NULL	2
2	1	NULL	6	2	2	6	2	2	2	1	NULL
3	2	2	3	2	2	3	2	2	2	1	NULL
3	2	2	6	2	2	6	2	2	2	1	NULL
5	1	NULL	2	1	NULL	2	1	NULL	1	NULL	2
5	1	NULL	5	1	NULL	5	1	NULL	1	NULL	2
6	2	2	3	2	2	3	2	2	2	1	NULL
6	2	2	6	2	2	6	2	2	2	1	NULL
explain
select *
from t1 where b in 
(select x.a from t1 as x join t1 as y on (y.a = x.b))
xor c > 5;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	6	Using where
2	DEPENDENT SUBQUERY	x	eq_ref	PRIMARY,b	PRIMARY	4	func	1	Parent of 2 pushed join@1; Using where; Full scan on NULL key
2	DEPENDENT SUBQUERY	y	eq_ref	PRIMARY	PRIMARY	4	test.x.b	1	Child of pushed join@1; Using where
select *
from t1 where b in 
(select x.a from t1 as x join t1 as y on (y.a = x.b))
xor c > 5;
a	b	c
3	2	2
6	2	2
explain
select t1.a, (select straight_join X.a from t1 as X join t1 as Y on X.a=Y.b where Y.a = t1.b) from t1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	6	
2	DEPENDENT SUBQUERY	X	ALL	PRIMARY	NULL	NULL	NULL	6	
2	DEPENDENT SUBQUERY	Y	eq_ref	PRIMARY,b	PRIMARY	4	test.t1.b	1	Using where
select t1.a, (select straight_join X.a from t1 as X join t1 as Y on X.a=Y.b where Y.a = t1.b) from t1;
a	(select straight_join X.a from t1 as X join t1 as Y on X.a=Y.b where Y.a = t1.b)
1	NULL
2	NULL
3	1
4	NULL
5	NULL
6	1
drop table t1;
create table t1 (a int primary key, b int) engine = ndb;
create table t2 (a int primary key, b int) engine = myisam;
insert into t1 values(1,1), (2,2), (3,3), (4,4);
insert into t2 values(1,1), (2,2), (3,3), (4,4);
explain
select * from t1, t2, t1 as t3
where t2.a = t1.b
and t3.a = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	
select * from t1, t2, t1 as t3
where t2.a = t1.b
and t3.a = t2.b;
a	b	a	b	a	b
1	1	1	1	1	1
2	2	2	2	2	2
3	3	3	3	3	3
4	4	4	4	4	4
drop table t1, t2;
create table t1 (a int primary key, b int, c blob) engine = ndb;
insert into t1 values (1,1, 'kalle');
insert into t1 values (2,1, 'kalle');
insert into t1 values (3,3, 'kalle');
insert into t1 values (4,1, 'kalle');
create table t2 (a int primary key, b int) engine = ndb;
insert into t2 values (1,1);
insert into t2 values (2,1);
insert into t2 values (3,3);
insert into t2 values (4,1);
set ndb_join_pushdown=true;
explain
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t2.a = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t2.a = t1.b;
a	b	a	b
1	1	1	1
2	1	1	1
3	3	3	3
4	1	1	1
explain
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t2.a = t1.b
and t1.a = 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t2.a = t1.b
and t1.a = 2;
a	b	a	b
2	1	1	1
explain
select t1.a, t1.b, t2.a, t2.b
from t1, t2
where t1.a = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	4	Parent of 2 pushed join@1
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	Child of pushed join@1
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t2.a = t1.b;
a	b	a	b
1	1	1	1
2	1	1	1
3	3	3	3
4	1	1	1
explain
select t1.a, t1.b, t2.a, t2.b
from t1, t2
where t1.a = t2.b
and t2.a = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	Child of pushed join@1
select t1.a, t1.b, t2.a, t2.b 
from t1, t2
where t1.a = t2.b
and t2.a = 3;
a	b	a	b
3	3	3	3
explain
select *
from t1, t2
where t2.a = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	
select *
from t1, t2
where t2.a = t1.b;
a	b	c	a	b
1	1	kalle	1	1
2	1	kalle	1	1
3	3	kalle	3	3
4	1	kalle	1	1
explain
select *
from t1, t2
where t2.a = t1.b
and t1.a = 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	4	const	1	
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	const	1	
select *
from t1, t2
where t2.a = t1.b
and t1.a = 2;
a	b	c	a	b
2	1	kalle	1	1
explain
select *
from t1, t2
where t1.a = t2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	4	
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	
select *
from t1, t2
where t2.a = t1.b;
a	b	c	a	b
1	1	kalle	1	1
2	1	kalle	1	1
3	3	kalle	3	3
4	1	kalle	1	1
explain
select *
from t1, t2
where t1.a = t2.b
and t2.a = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	const	PRIMARY	PRIMARY	4	const	1	
1	SIMPLE	t1	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	
select *
from t1, t2
where t1.a = t2.b
and t2.a = 3;
a	b	c	a	b
3	3	kalle	3	3
drop table t1, t2;
create table t3 (a3 int, b3 tinyint, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3="63";
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	5	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3="63";
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 tinyint unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	5	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 smallint, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	6	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 smallint unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	6	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 mediumint, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	7	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 mediumint unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	7	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 int, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 int unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 bigint, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 bigint unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=(60+3);
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 boolean, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0, 1, 0x1f);
insert into t3 values (0x2f, 1, 2, 0x2f);
insert into t3 values (0x3f, 0, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	5	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=1;
a3	b3	c3	d3	a3	b3	c3	d3
47	1	2	47	47	1	2	47
drop table t3;
create table t3 (a3 int, b3 float, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 2.71, 1, 0x1f);
insert into t3 values (0x2f, 3.00, 2, 0x2f);
insert into t3 values (0x3f, 0.50, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.0;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,const	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.0;
a3	b3	c3	d3	a3	b3	c3	d3
47	3	2	47	47	3	2	47
drop table t3;
create table t3 (a3 int, b3 float unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 2.71, 1, 0x1f);
insert into t3 values (0x2f, 3.00, 2, 0x2f);
insert into t3 values (0x3f, 0.50, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.0;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	8	test.x.d3,const	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.0;
a3	b3	c3	d3	a3	b3	c3	d3
47	3	2	47	47	3	2	47
drop table t3;
create table t3 (a3 int, b3 double, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 2.71, 1, 0x1f);
insert into t3 values (0x2f, 3.14, 2, 0x2f);
insert into t3 values (0x3f, 0.50, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
a3	b3	c3	d3	a3	b3	c3	d3
47	3.14	2	47	47	3.14	2	47
drop table t3;
create table t3 (a3 int, b3 double unsigned, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 2.71, 1, 0x1f);
insert into t3 values (0x2f, 3.14, 2, 0x2f);
insert into t3 values (0x3f, 0.50, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
a3	b3	c3	d3	a3	b3	c3	d3
47	3.14	2	47	47	3.14	2	47
drop table t3;
create table t3 (a3 int, b3 decimal, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=63;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	9	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=63;
a3	b3	c3	d3	a3	b3	c3	d3
47	63	2	47	47	63	2	47
drop table t3;
create table t3 (a3 int, b3 decimal(12,4), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 2.71, 1, 0x1f);
insert into t3 values (0x2f, 3.14, 2, 0x2f);
insert into t3 values (0x3f, 0.50, 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	10	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3=3.14;
a3	b3	c3	d3	a3	b3	c3	d3
47	3.1400	2	47	47	3.1400	2	47
drop table t3;
create table t3 (a3 int, b3 date, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, '1905-05-17', 1, 0x1f);
insert into t3 values (0x2f, '2000-02-28', 2, 0x2f);
insert into t3 values (0x3f, '2000-02-29', 3, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='2000-02-28';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	7	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='2000-02-28';
a3	b3	c3	d3	a3	b3	c3	d3
47	2000-02-28	2	47	47	2000-02-28	2	47
drop table t3;
create table t3 (a3 int, b3 datetime, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, '1905-05-17 12:30:00', 1, 0x1f);
insert into t3 values (0x2f, '2000-02-28 23:59:00', 2, 0x2f);
insert into t3 values (0x3f, '2000-02-29 12:59:59', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='2000-02-28 23:59';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='2000-02-28 23:59';
a3	b3	c3	d3	a3	b3	c3	d3
47	2000-02-28 23:59:00	2	47	47	2000-02-28 23:59:00	2	47
drop table t3;
create table t3 (a3 int, b3 time, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, '12:30:00', 1, 0x1f);
insert into t3 values (0x2f, '23:59:00', 2, 0x2f);
insert into t3 values (0x3f, '12:59:59', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='23:59';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	7	test.x.d3,const	1	Child of pushed join@1
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='23:59';
a3	b3	c3	d3	a3	b3	c3	d3
47	23:59:00	2	47	47	23:59:00	2	47
drop table t3;
create table t3 (a3 int, b3 char(16), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 'Ole', 1, 0x1f);
insert into t3 values (0x2f, 'Dole', 2, 0x2f);
insert into t3 values (0x3f, 'Doffen', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	20	test.x.d3,const	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
a3	b3	c3	d3	a3	b3	c3	d3
47	Dole	2	47	47	Dole	2	47
drop table t3;
create table t3 (a3 int, b3 varchar(16), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 'Ole', 1, 0x1f);
insert into t3 values (0x2f, 'Dole', 2, 0x2f);
insert into t3 values (0x3f, 'Doffen', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	22	test.x.d3,const	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
a3	b3	c3	d3	a3	b3	c3	d3
47	Dole	2	47	47	Dole	2	47
drop table t3;
create table t3 (a3 int, b3 varchar(512), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 'Ole', 1, 0x1f);
insert into t3 values (0x2f, 'Dole', 2, 0x2f);
insert into t3 values (0x3f, 'Doffen', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	518	test.x.d3,const	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
a3	b3	c3	d3	a3	b3	c3	d3
47	Dole	2	47	47	Dole	2	47
drop table t3;
create table t3 (a3 int, b3 binary(16), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 'Ole', 1, 0x1f);
insert into t3 values (0x2f, 'Dole', 2, 0x2f);
insert into t3 values (0x3f, 'Doffen', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	20	test.x.d3,const	1	Child of pushed join@1; Using where
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
a3	b3	c3	d3	a3	b3	c3	d3
drop table t3;
create table t3 (a3 int, b3 varbinary(16), c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 'Ole', 1, 0x1f);
insert into t3 values (0x2f, 'Dole', 2, 0x2f);
insert into t3 values (0x3f, 'Doffen', 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	4	const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	22	test.x.d3,const	1	Child of pushed join@1; Using where
select * from t3 x, t3 y where x.a3=0x2f and y.a3=x.d3 and y.b3='Dole';
a3	b3	c3	d3	a3	b3	c3	d3
47	Dole	2	47	47	Dole	2	47
drop table t3;
create table t3 (a3 int, b3 tinyint, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values (0x1f, 0x2f, 1, 0x1f);
insert into t3 values (0x2f, 0x3f, 2, 0x2f);
insert into t3 values (0x3f, 0x1f, 3, 0x3f);
explain
select * from t3 x, t3 y where y.a3=x.b3 and y.b3="63";
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	5	test.x.b3,const	1	Using where
select * from t3 x, t3 y where y.a3=x.b3 and y.b3="63";
a3	b3	c3	d3	a3	b3	c3	d3
31	47	1	31	47	63	2	47
drop table t3;
create table t3 (a3 varchar(16), b3 int, c3 int not null, d3 int not null, 
primary key(a3,b3)) engine = ndb;
insert into t3 values ('Ole', 0x1f, 1, 0x1f);
insert into t3 values ('Dole', 0x2f, 2, 0x2f);
insert into t3 values ('Doffen', 0x3f, 2, 0x3f);
explain
select * from t3 x, t3 y where x.a3='Dole' and x.b3=0x2f and y.a3=x.a3 and y.b3=x.d3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	const	PRIMARY	PRIMARY	22	const,const	1	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	22	const,test.x.d3	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3='Dole' and x.b3=0x2f and y.a3=x.a3 and y.b3=x.d3;
a3	b3	c3	d3	a3	b3	c3	d3
Dole	47	2	47	Dole	47	2	47
explain
select * from t3 x, t3 y where x.a3='Dole' and y.a3=x.a3 and y.b3=x.d3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY	PRIMARY	18	const	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	22	const,test.x.d3	1	Child of pushed join@1; Using where with pushed condition
select * from t3 x, t3 y where x.a3='Dole' and y.a3=x.a3 and y.b3=x.d3;
a3	b3	c3	d3	a3	b3	c3	d3
Dole	47	2	47	Dole	47	2	47
drop table t3;
create table t1 (k int primary key, b int) engine = ndb;
insert into t1 values (1,1), (2,1), (3,1), (4,1);
explain
select *
from t1
straight_join t1 as t2 on t2.k = t1.b+0
straight_join t1 as t3 on t3.k = t2.b
straight_join t1 as t4 on t4.k = t1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	4	func	1	Parent of 2 pushed join@2; Using where
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	Child of pushed join@2
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select *
from t1
straight_join t1 as t2 on t2.k = t1.b+0
straight_join t1 as t3 on t3.k = t2.b
straight_join t1 as t4 on t4.k = t1.b;
k	b	k	b	k	b	k	b
1	1	1	1	1	1	1	1
2	1	1	1	1	1	1	1
3	1	1	1	1	1	1	1
4	1	1	1	1	1	1	1
explain
select *
from t1
straight_join t1 as t2 on t2.k = t1.b+0
straight_join t1 as t3 on t3.k = t2.b
straight_join t1 as t4 on t4.k = t1.b
where t2.k = 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	4	Parent of 2 pushed join@1; Using where
1	SIMPLE	t2	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@2
1	SIMPLE	t3	eq_ref	PRIMARY	PRIMARY	4	test.t2.b	1	Child of pushed join@2
1	SIMPLE	t4	eq_ref	PRIMARY	PRIMARY	4	test.t1.b	1	Child of pushed join@1
select *
from t1
straight_join t1 as t2 on t2.k = t1.b+0
straight_join t1 as t3 on t3.k = t2.b
straight_join t1 as t4 on t4.k = t1.b
where t2.k = 1;
k	b	k	b	k	b	k	b
1	1	1	1	1	1	1	1
2	1	1	1	1	1	1	1
3	1	1	1	1	1	1	1
4	1	1	1	1	1	1	1
drop table t1;
CREATE TABLE t1 (
a int NOT NULL auto_increment,
b char(255) not null,
c int NOT NULL,
d char(255) not null,
PRIMARY KEY (`a`,`b`)
) ENGINE=ndbcluster;
select count(*)
from t1 
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
join t1 as t3 on t3.a = t2.c and t3.b = t2.d;
count(*)
2996
select count(*)
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d;
count(*)
8990
select count(*)
from t1
join t1 as t2 on t2.a = t1.c and t2.b = t1.d
join t1 as t3 on t3.a = t2.c;
count(*)
8988
alter table t1 partition by key(a);
select count(*)
from t1
join t1 as t2 on t2.a = t1.c
join t1 as t3 on t3.a = t2.c and t3.b = t2.d;
count(*)
8990
drop table t1;
CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'undofile.dat'
INITIAL_SIZE 1M
UNDO_BUFFER_SIZE = 1M
ENGINE=NDB;
CREATE TABLESPACE ts1
ADD DATAFILE 'datafile.dat'
USE LOGFILE GROUP lg1
INITIAL_SIZE 6M
ENGINE NDB;
create table T1 (a int NOT NULL, 
b int NOT NULL storage disk, 
c int NOT NULL storage memory, 
primary key(a)) 
TABLESPACE ts1 STORAGE DISK engine = ndb;
insert into T1 values (10, 11, 11);
insert into T1 values (11, 12, 12);
insert into T1 values (12, 13, 13);
create table T2 (a int not null, 
b int not null, primary key(a)) engine = ndb;
insert into T2 values (10, 11);
insert into T2 values (11, 12);
insert into T2 values (12, 13);
explain select * from T1, T2 where T1.c = T2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T1	ALL	NULL	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	T2	eq_ref	PRIMARY	PRIMARY	4	test.T1.c	1	Child of pushed join@1
select * from T1, T2 where T1.c = T2.a;
a	b	c	a	b
10	11	11	11	12
11	12	12	12	13
explain select * from T1, T2 where T1.a=11 and T1.c = T2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T1	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	T2	eq_ref	PRIMARY	PRIMARY	4	test.T1.c	1	Child of pushed join@1
select * from T1, T2 where T1.a=11 and T1.c = T2.a;
a	b	c	a	b
11	12	12	12	13
explain select * from T2, T1 where T2.b = T1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T2	ALL	NULL	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	T1	eq_ref	PRIMARY	PRIMARY	4	test.T2.b	1	Child of pushed join@1
select * from T2, T1 where T2.b = T1.a;
a	b	a	b	c
10	11	11	12	12
11	12	12	13	13
explain select * from T2, T1 where T2.a=11 and T2.b = T1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T2	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	T1	eq_ref	PRIMARY	PRIMARY	4	test.T2.b	1	Child of pushed join@1
select * from T2, T1 where T2.a=11 and T2.b = T1.a;
a	b	a	b	c
11	12	12	13	13
explain select T1.a, T1.c, T2.a, T2.b from T1, T2 where T1.b = T2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T1	ALL	NULL	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	T2	eq_ref	PRIMARY	PRIMARY	4	test.T1.b	1	Child of pushed join@1
select T1.a, T1.c, T2.a, T2.b from T1, T2 where T1.b = T2.a;
a	c	a	b
10	11	11	12
11	12	12	13
explain select T1.a, T1.c, T2.a, T2.b from T1, T2 where T1.a=11 and T1.b = T2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	T1	const	PRIMARY	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	T2	eq_ref	PRIMARY	PRIMARY	4	test.T1.b	1	Child of pushed join@1
select T1.a, T1.c, T2.a, T2.b from T1, T2 where T1.a=11 and T1.b = T2.a;
a	c	a	b
11	12	12	13
drop table T1;
drop table T2;
ALTER TABLESPACE ts1
DROP DATAFILE 'datafile.dat'
ENGINE NDB;
drop tablespace ts1
engine ndb;
drop logfile group lg1
engine ndb;
create temporary table old_count 
select counter_name, sum(val) AS val 
from ndbinfo.counters 
where block_name='DBSPJ' 
group by counter_name;
create table T1 (a int NOT NULL, 
b int NOT NULL,
c int NOT NULL,
primary key(a)) 
engine = ndb;
insert into T1 values (1, 2, 2);
insert into T1 values (2, 3, 3);
insert into T1 values (3, 4, 4);
select * from T1 t1, T1 t2 where t1.a = 2 and t2.a = t1.b;
a	b	c	a	b	c
2	3	3	3	4	4
select count(*) from T1 t1, T1 t2 where t2.a = t1.b;
count(*)
2
select count(*) from T1 t1, T1 t2 where t1.a >= 2 and t2.a = t1.b;
count(*)
1
create temporary table new_count 
select counter_name, sum(val) AS val 
from ndbinfo.counters 
where block_name='DBSPJ' 
group by counter_name;
select new_count.counter_name, new_count.val - old_count.val 
from new_count, old_count 
where new_count.counter_name = old_count.counter_name
and new_count.counter_name <> 'LOCAL_READS_SENT'
       and new_count.counter_name <> 'REMOTE_READS_SENT';
counter_name	new_count.val - old_count.val
CONST_PRUNED_RANGE_SCANS_RECEIVED	0
LOCAL_RANGE_SCANS_SENT	2
LOCAL_TABLE_SCANS_SENT	2
PRUNED_RANGE_SCANS_RECEIVED	0
RANGE_SCANS_RECEIVED	2
READS_NOT_FOUND	2
READS_RECEIVED	1
REMOTE_RANGE_SCANS_SENT	0
SCAN_BATCHES_RETURNED	4
SCAN_ROWS_RETURNED	8
TABLE_SCANS_RECEIVED	2
select 'READS_SENT', sum(new_count.val - old_count.val) 
from new_count, old_count 
where new_count.counter_name = old_count.counter_name
and (new_count.counter_name = 'LOCAL_READS_SENT'
       or new_count.counter_name = 'REMOTE_READS_SENT');
READS_SENT	sum(new_count.val - old_count.val)
READS_SENT	7
drop table old_count;
drop table new_count;
drop table T1;
create table T1 (
a int primary key, 
b int,
c int) engine = ndb;
insert into T1 values (1, 2, 3);
insert into T1 values (2, 3, 4);
insert into T1 values (3, 4, 5);
explain select * from T1 x, T1 y where x.b=y.a and x.c=4;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	4	test.x.b	1	Child of pushed join@1
select * from T1 x, T1 y where x.b=y.a and x.c=4;
a	b	c	a	b	c
2	3	4	3	4	5
lookups
1
explain select * from T1 x, T1 y, T1 z where x.b=y.a and y.c=4 and y.b=z.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 3 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	4	test.x.b	1	Child of pushed join@1; Using where with pushed condition
1	SIMPLE	z	eq_ref	PRIMARY	PRIMARY	4	test.y.b	1	Child of pushed join@1
select * from T1 x, T1 y, T1 z where x.b=y.a and y.c=4 and y.b=z.a;
a	b	c	a	b	c	a	b	c
1	2	3	2	3	4	3	4	5
lookups
5
drop table T1;
create table T1(
a int not null,
b int not null,
c int not null,
primary key(a,b))
engine = ndb partition by key (a);
insert into T1 values (10, 10, 11);
insert into T1 values (11, 11, 12);
insert into T1 values (12, 12, 13);
select * from T1 t1, T1 t2 
where t1.a = 10 and t1.b = 10 and 
t2.a = t1.c and t2.b = t1.c;
a	b	c	a	b	c
10	10	11	11	11	12
select * from T1 t1, T1 t2 
where t1.a = 11 and t1.b = 11 and 
t2.a = t1.c and t2.b = t1.c;
a	b	c	a	b	c
11	11	12	12	12	13
select * from T1 t1, T1 t2 
where t2.a = t1.c and t2.b = t1.c
order by t1.a;
a	b	c	a	b	c
10	10	11	11	11	12
11	11	12	12	12	13
select count(*) from T1 t1, T1 t2 
where t1.a = 11 and 
t2.a = t1.c and t2.b = t1.c;
count(*)
1
scan_count
2
pruned_scan_count
1
sorted_scan_count
1
pushed_queries_defined
3
pushed_queries_dropped
0
pushed_queries_executed
3
pushed_reads
4
drop table T1;
create table T1(
d int not null,
c int not null,
a int not null,
b int not null,
primary key using hash (a,b))
engine = ndb partition by key (a);
insert into T1(a,b,c,d) values (10, 10, 11, 11);
insert into T1(a,b,c,d) values (11, 11, 12, 12);
insert into T1(a,b,c,d) values (12, 12, 13, 13);
create index i1 on T1(c,a);
explain select count(*) from T1 t1, T1 t2 where t1.c = 12 and t1.a = 11 and t2.a = t1.d and t2.b = t1.d;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ref	PRIMARY,i1	i1	8	const,const	10	Parent of 2 pushed join@1
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	8	test.t1.d,test.t1.d	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where t1.c = 12 and t1.a = 11 and t2.a = t1.d and t2.b = t1.d;
count(*)
1
drop index i1 on T1;
pruned_scan_count
1
create index i2 on T1(a,b);
explain select count(*) from T1 t1, T1 t2 where t1.a = 11 and t1.b<13 and t2.a = t1.c and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY,i2	i2	8	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY,i2	PRIMARY	8	test.t1.c,test.t1.c	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where t1.a = 11 and t1.b<13 and t2.a = t1.c and t2.b = t1.c;
count(*)
1
pruned_scan_count
1
explain select count(*) from T1 t1, T1 t2 where t1.a >= 12 and t1.a<=12 and t2.a = t1.c and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY,i2	i2	4	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY,i2	PRIMARY	8	test.t1.c,test.t1.c	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where t1.a >= 12 and t1.a<=12 and t2.a = t1.c and t2.b = t1.c;
count(*)
0
pruned_scan_count
1
explain select count(*) from T1 t1, T1 t2 where t1.a >= 11 and t1.a<=12 and t2.a = t1.c and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY,i2	i2	4	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY,i2	PRIMARY	8	test.t1.c,test.t1.c	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where t1.a >= 11 and t1.a<=12 and t2.a = t1.c and t2.b = t1.c;
count(*)
1
pruned_scan_count
0
explain select count(*) from T1 t1, T1 t2 where (t1.a = 10 or t1.a=12) and t1.b<13 and t2.a = t1.c and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY,i2	i2	8	NULL	20	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY,i2	PRIMARY	8	test.t1.c,test.t1.c	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where (t1.a = 10 or t1.a=12) and t1.b<13 and t2.a = t1.c and t2.b = t1.c;
count(*)
1
pruned_scan_count
0
explain select count(*) from T1 t1, T1 t2 where t1.a = 10 and (t1.b<11 or t1.b>11) and t2.a = t1.c and t2.b = t1.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY,i2	i2	8	NULL	20	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	eq_ref	PRIMARY,i2	PRIMARY	8	test.t1.c,test.t1.c	1	Child of pushed join@1
select count(*) from T1 t1, T1 t2 where t1.a = 10 and (t1.b<11 or t1.b>11) and t2.a = t1.c and t2.b = t1.c;
count(*)
1
pruned_scan_count
1
drop table T1;
create table T2(
d int not null,
e int not null,
f int not null,
a int not null,
b int not null,
c int not null,
primary key using hash (a,b,c))
engine = ndb partition by key (b,a);
insert into T2(a,b,c,d,e,f) values (1, 2, 3, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (1, 2, 4, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (2, 3, 4, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (3, 4, 5, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (4, 5, 6, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (5, 6, 7, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (6, 7, 8, 1, 2, 3);
insert into T2(a,b,c,d,e,f) values (7, 8, 9, 1, 2, 3);
create index i2_1 on T2(d, a, b, e);
explain select count(*) from T2 x, T2 y where x.d=1 and x.a=1 and x.b=2 and y.a=x.d and y.b=x.e and y.c=3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY,i2_1	i2_1	12	const,const,const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	12	const,test.x.e,const	1	Child of pushed join@1
select count(*) from T2 x, T2 y where x.d=1 and x.a=1 and x.b=2 and y.a=x.d and y.b=x.e and y.c=3;
count(*)
2
drop index i2_1 on T2;
pruned_scan_count
1
create index i2_3 on T2(a, d, b, e);
explain select count(*) from T2 x, T2 y where x.d=1 and x.a=1 and x.b=2 and y.a=x.d and y.b=x.e and y.c=3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ref	PRIMARY,i2_3	i2_3	12	const,const,const	10	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY,i2_3	PRIMARY	12	const,test.x.e,const	1	Child of pushed join@1
select count(*) from T2 x, T2 y where x.d=1 and x.a=1 and x.b=2 and y.a=x.d and y.b=x.e and y.c=3;
count(*)
2
drop table T2;
pruned_scan_count
1
create table t1 (a binary(10) primary key, b binary(10) not null) engine = ndb;
insert into t1 values ('\0123456789', '1234567890');
insert into t1 values ('1234567890', '\0123456789');
explain
select count(*)
from t1 join t1 as t2 on t2.a = t1.b
where t1.a = '\0123456789';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	const	PRIMARY	PRIMARY	10	const	1	Parent of 2 pushed join@1; Using where
1	SIMPLE	t2	eq_ref	PRIMARY	PRIMARY	10	test.t1.b	1	Child of pushed join@1
select count(*)
from t1 join t1 as t2 on t2.a = t1.b
where t1.a = '\0123456789';
count(*)
1
drop table t1;
create table t1 (pk int primary key, a int unique key) engine = ndb;
insert into t1 values (1,10), (2,20), (3,30);
set ndb_join_pushdown = false;
explain
select * from t1 as x right join t1 as y
on x.pk = y.pk
and x.pk = y.a
and x.a = y.pk
where y.pk = 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	const	PRIMARY	PRIMARY	4	const	1	
1	SIMPLE	x	const	PRIMARY,a	NULL	NULL	NULL	1	Impossible ON condition
select * from t1 as x right join t1 as y
on x.pk = y.pk
and x.pk = y.a
and x.a = y.pk
where y.pk = 2;
pk	a	pk	a
NULL	NULL	2	20
set ndb_join_pushdown = true;
explain
select * from t1 as x right join t1 as y
on x.pk = y.pk
and x.pk = y.a
and x.a = y.pk
where y.pk = 2;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	const	PRIMARY	PRIMARY	4	const	1	
1	SIMPLE	x	const	PRIMARY,a	PRIMARY	4	const	1	
select * from t1 as x right join t1 as y
on x.pk = y.pk
and x.pk = y.a
and x.a = y.pk
where y.pk = 2;
pk	a	pk	a
NULL	NULL	2	20
drop table t1;
create table t1 (pk int primary key, u int not null, a int, b int) engine=ndb;
create index ix1 on t1(b,a);
insert into t1 values (0,1,10,20);
insert into t1 values (1,2,20,30);
insert into t1 values (2,3,30,40);
explain select * from t1 as x join t1 as y join t1 as z on x.u=y.pk and y.a=z.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	3	Parent of 3 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	4	test.x.u	1	Child of pushed join@1
1	SIMPLE	z	ref	ix1	ix1	5	test.y.a	1	Child of pushed join@1; Using where
select * from t1 as x join t1 as y join t1 as z on x.u=y.pk and y.a=z.b;
pk	u	a	b	pk	u	a	b	pk	u	a	b
0	1	10	20	1	2	20	30	0	1	10	20
1	2	20	30	2	3	30	40	1	2	20	30
drop table t1;
create table t1 (pk int primary key, u int not null) engine=ndb;
insert into t1 values (0,-1), (1,-1), (2,-1), (3,-1), (4,-1), (5,-1), (6,-1), 
(7,-1), (8,-1), (9,-1), (10,-1), (11,-1), (12,-1), (13,-1), (14,-1), (15,-1), 
(16,-1), (17,-1), (18,-1), (19,-1), (20,-1), (21,-1), (22,-1), (23,-1), 
(24,-1), (25,-1), (26,-1), (27,-1), (28,-1), (29,-1), (30,-1), (31,-1), 
(32,-1), (33,-1), (34,-1), (35,-1), (36,-1), (37,-1), (38,-1), (39,-1), 
(40,-1), (41,-1), (42,-1), (43,-1), (44,-1), (45,-1), (46,-1), (47,-1), 
(48,-1), (49,-1), (50,-1), (51,-1), (52,-1), (53,-1), (54,-1), (55,-1), 
(56,-1), (57,-1), (58,-1), (59,-1), (60,-1), (61,-1), (62,-1), (63,-1), 
(64,-1), (65,-1), (66,-1), (67,-1), (68,-1), (69,-1), (70,-1), (71,-1), 
(72,-1), (73,-1), (74,-1), (75,-1), (76,-1), (77,-1), (78,-1), (79,-1), 
(80,-1), (81,-1), (82,-1), (83,-1), (84,-1), (85,-1), (86,-1), (87,-1), 
(88,-1), (89,-1), (90,-1), (91,-1), (92,-1), (93,-1), (94,-1), (95,-1), 
(96,-1), (97,-1), (98,-1), (99,-1), (100,-1), (101,-1), (102,-1), (103,-1), 
(104,-1), (105,-1), (106,-1), (107,-1), (108,-1), (109,-1), (110,-1), 
(111,-1), (112,-1), (113,-1), (114,-1), (115,-1), (116,-1), (117,-1), 
(118,-1), (119,-1), (120,-1), (121,-1), (122,-1), (123,-1), (124,-1), 
(125,-1), (126,-1), (127,-1), (128,-1), (129,-1), (130,-1), (131,-1), 
(132,-1), (133,-1), (134,-1), (135,-1), (136,-1), (137,-1), (138,-1), (139,-1);
explain select * from t1 as x join t1 as y on x.u=y.pk order by(x.pk);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	index	NULL	PRIMARY	4	NULL	140	Parent of 2 pushed join@1
1	SIMPLE	y	eq_ref	PRIMARY	PRIMARY	4	test.x.u	1	Child of pushed join@1
select * from t1 as x join t1 as y on x.u=y.pk order by(x.pk);
pk	u	pk	u
drop table t1;
create table t1 (pk int primary key, u int not null, a int, b int) engine=ndb;
create index ix1 on t1(b,a);
create unique index ix2 on t1(u);
insert into t1 values (0,0,10,10);
insert into t1 values (1,1,10,10);
insert into t1 values (2,2,10,10);
insert into t1 values (3,3,10,10);
insert into t1 values (4,4,10,10);
insert into t1 values (5,5,10,10);
insert into t1 values (6,6,10,10);
insert into t1 values (7,7,10,10);
insert into t1 values (8,8,10,10);
insert into t1 values (9,9,10,10);
insert into t1 values (10,10,10,10);
insert into t1 values (11,11,10,10);
explain select count(*) from t1 as x1 join t1 as x2 join t1 as x3 
on x1.a=x2.u and x2.a = x3.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	12	Parent of 3 pushed join@1
1	SIMPLE	x2	eq_ref	ix2	ix2	4	test.x1.a	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	Child of pushed join@1; Using where
select count(*) from t1 as x1 join t1 as x2 join t1 as x3 
on x1.a=x2.u and x2.a = x3.b;
count(*)
144
explain select count(*) from t1 as x1, t1 as x2, t1 as x3 
where x1.u=x2.pk and x1.a=x3.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	ix2	NULL	NULL	NULL	12	Parent of 3 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.u	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
select count(*) from t1 as x1, t1 as x2, t1 as x3 
where x1.u=x2.pk and x1.a=x3.b;
count(*)
144
insert into t1 values (12,12,20,10);
explain select count(*) from t1 as x1 left join t1 as x2 on x1.a=x2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	
select count(*) from t1 as x1 left join t1 as x2 on x1.a=x2.b;
count(*)
157
set ndb_join_pushdown=off;
select count(*) from t1 as x1 left join t1 as x2 on x1.a=x2.b;
count(*)
157
set ndb_join_pushdown=on;
explain select count(*) from t1 as x1 
left join t1 as x2 on x1.u=x2.pk 
left join t1 as x3 on x2.a=x3.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.u	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	
select count(*) from t1 as x1 
left join t1 as x2 on x1.u=x2.pk 
left join t1 as x3 on x2.a=x3.b;
count(*)
157
set ndb_join_pushdown=off;
select count(*) from t1 as x1 
left join t1 as x2 on x1.u=x2.pk 
left join t1 as x3 on x2.a=x3.b;
count(*)
157
set ndb_join_pushdown=on;
explain select count(*) from t1 as x1
left join t1 as x2 on x1.u=x2.pk
left join t1 as x3 on x2.a=x3.b
left join t1 as x4 on x3.u=x4.pk
left join t1 as x5 on x4.a=x5.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.u	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	Parent of 2 pushed join@2
1	SIMPLE	x4	eq_ref	PRIMARY	PRIMARY	4	test.x3.u	1	Child of pushed join@2
1	SIMPLE	x5	ref	ix1	ix1	5	test.x4.a	1	
select count(*) from t1 as x1
left join t1 as x2 on x1.u=x2.pk
left join t1 as x3 on x2.a=x3.b
left join t1 as x4 on x3.u=x4.pk
left join t1 as x5 on x4.a=x5.b;
count(*)
1885
set ndb_join_pushdown=off;
select count(*) from t1 as x1
left join t1 as x2 on x1.u=x2.pk
left join t1 as x3 on x2.a=x3.b
left join t1 as x4 on x3.u=x4.pk
left join t1 as x5 on x4.a=x5.b;
count(*)
1885
set ndb_join_pushdown=on;
explain select count(*) from t1 as x1
join t1 as x2 on x1.a=x2.b
where x1.pk = 1 or x1.u=1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	index_merge	PRIMARY,ix2	ix2,PRIMARY	4,4	NULL	2	Using sort_union(ix2,PRIMARY); Using where with pushed condition
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Using where
select count(*) from t1 as x1
join t1 as x2 on x1.a=x2.b
where x1.pk = 1 or x1.u=1;
count(*)
13
set ndb_join_pushdown=on;
explain
select straight_join * from t1 as table1
left join 
(t1 as table2  join t1 as table3 on table2.pk = table3.b)
on table1.pk = table2.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	table1	ALL	NULL	NULL	NULL	NULL	13	
1	SIMPLE	table2	ref	PRIMARY,ix1	ix1	5	test.table1.pk	1	Parent of 2 pushed join@1
1	SIMPLE	table3	ref	ix1	ix1	5	test.table2.pk	1	Child of pushed join@1
select straight_join * from t1 as table1
left join 
(t1 as table2  join t1 as table3 on table2.pk = table3.b)
on table1.pk = table2.b;
pk	u	a	b	pk	u	a	b	pk	u	a	b
0	0	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
1	1	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
10	10	10	10	10	10	10	10	0	0	10	10
10	10	10	10	10	10	10	10	1	1	10	10
10	10	10	10	10	10	10	10	10	10	10	10
10	10	10	10	10	10	10	10	11	11	10	10
10	10	10	10	10	10	10	10	12	12	20	10
10	10	10	10	10	10	10	10	2	2	10	10
10	10	10	10	10	10	10	10	3	3	10	10
10	10	10	10	10	10	10	10	4	4	10	10
10	10	10	10	10	10	10	10	5	5	10	10
10	10	10	10	10	10	10	10	6	6	10	10
10	10	10	10	10	10	10	10	7	7	10	10
10	10	10	10	10	10	10	10	8	8	10	10
10	10	10	10	10	10	10	10	9	9	10	10
11	11	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
12	12	20	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
2	2	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
3	3	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
4	4	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
5	5	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
6	6	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
7	7	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
8	8	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
9	9	10	10	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
explain select straight_join * from t1 as x1 
inner join t1 as x2 on x2.b = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
explain select straight_join * from t1 as x1 
left join t1 as x2 on x2.b = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	
explain select straight_join * from t1 as x1 
right join t1 as x2 on x2.b = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x2	ALL	NULL	NULL	NULL	NULL	13	
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	
explain select straight_join * from 
t1 as x1 inner join
(t1 as x2 inner join t1 as x3 on x3.b = x2.a)
on x2.pk = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 3 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.a	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	Child of pushed join@1; Using where
explain select straight_join * from 
t1 as x1 left join
(t1 as x2 inner join t1 as x3 on x3.b = x2.a)
on x2.pk = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.a	1	Child of pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	
explain select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	ix1	NULL	NULL	NULL	13	Parent of 3 pushed join@1
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
1	SIMPLE	x3	ref	ix1	ix1	5	test.x1.b	1	Child of pushed join@1; Using where
set ndb_join_pushdown=off;
select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
count(*)
2028
set ndb_join_pushdown=on;
select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
count(*)
2028
explain select straight_join count(*) from t1 as x1 
left join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	ix1	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	
1	SIMPLE	x3	ref	ix1	ix1	5	test.x1.b	1	Child of pushed join@1; Using where
set ndb_join_pushdown=off;
select straight_join count(*) from t1 as x1 
left join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
count(*)
2041
set ndb_join_pushdown=on;
select straight_join count(*) from t1 as x1 
left join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.b = x1.b;
count(*)
2041
explain select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
left join t1 as x3 on x3.b = x1.b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
1	SIMPLE	x3	ref	ix1	ix1	5	test.x1.b	1	
set ndb_join_pushdown=off;
select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
left join t1 as x3 on x3.b = x1.b;
count(*)
2028
set ndb_join_pushdown=on;
select straight_join count(*) from t1 as x1 
join t1 as x2 on x2.b = x1.a
left join t1 as x3 on x3.b = x1.b;
count(*)
2028
explain
select straight_join count(*) from t1 as x1
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.pk = x1.a join t1 as x4 on x4.b = x3.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 3 pushed join@1
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
1	SIMPLE	x3	eq_ref	PRIMARY	PRIMARY	4	test.x1.a	1	Child of pushed join@1
1	SIMPLE	x4	ref	ix1	ix1	5	test.x3.a	1	Using where
set ndb_join_pushdown=off;
select straight_join count(*) from t1 as x1
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.pk = x1.a join t1 as x4 on x4.b = x3.a;
count(*)
2028
set ndb_join_pushdown=on;
select straight_join count(*) from t1 as x1
join t1 as x2 on x2.b = x1.a
join t1 as x3 on x3.pk = x1.a join t1 as x4 on x4.b = x3.a;
count(*)
2028
explain select straight_join count(*) from t1 as x1 
left join t1 as x3 on x3.b = x1.a
join t1 as x2 on x2.pk = x1.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	NULL	NULL	NULL	NULL	13	Parent of 2 pushed join@1
1	SIMPLE	x3	ref	ix1	ix1	5	test.x1.a	1	
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	4	test.x1.a	1	Child of pushed join@1
select straight_join count(*) from t1 as x1 
left join t1 as x3 on x3.b = x1.a
join t1 as x2 on x2.pk = x1.a;
count(*)
156
update t1 set b=b+10;
select straight_join count(*) from t1 as x1 
left join t1 as x3 on x3.b = x1.a
join t1 as x2 on x2.pk = x1.a;
count(*)
12
update t1 set b=b-10;
update t1 set u=u+100;
set ndb_join_pushdown=on;
explain select count(*) from 
(t1 as x join t1 as y on y.b = x.a)
left outer join t1 as z on z.u = x.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	13	Parent of 3 pushed join@1
1	SIMPLE	y	ref	ix1	ix1	5	test.x.a	1	Child of pushed join@1; Using where
1	SIMPLE	z	eq_ref	ix2	ix2	4	test.y.b	1	Child of pushed join@1
select count(*) from 
(t1 as x join t1 as y on y.b = x.a)
left outer join t1 as z on z.u = x.a;
count(*)
156
update t1 set u=u-100;
drop index ix2 on t1;
create unique index ix2 on t1(a,u);
set ndb_join_pushdown=on;
explain
select straight_join * from
t1 as table1 join 
(t1 as table2 join t1 as table3 on table3.a = table2.a)
on table3.u = table1.u
where table2.pk = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	table1	ALL	NULL	NULL	NULL	NULL	13	
1	SIMPLE	table2	const	PRIMARY,ix2	PRIMARY	4	const	1	Parent of 2 pushed join@1
1	SIMPLE	table3	ref	ix2	ix2	9	test.table2.a,test.table1.u	1	Child of pushed join@1; Using where
select straight_join * from
t1 as table1 join 
(t1 as table2 join t1 as table3 on table3.a = table2.a)
on table3.u = table1.u
where table2.pk = 3;
pk	u	a	b	pk	u	a	b	pk	u	a	b
0	0	10	10	3	3	10	10	0	0	10	10
1	1	10	10	3	3	10	10	1	1	10	10
10	10	10	10	3	3	10	10	10	10	10	10
11	11	10	10	3	3	10	10	11	11	10	10
2	2	10	10	3	3	10	10	2	2	10	10
3	3	10	10	3	3	10	10	3	3	10	10
4	4	10	10	3	3	10	10	4	4	10	10
5	5	10	10	3	3	10	10	5	5	10	10
6	6	10	10	3	3	10	10	6	6	10	10
7	7	10	10	3	3	10	10	7	7	10	10
8	8	10	10	3	3	10	10	8	8	10	10
9	9	10	10	3	3	10	10	9	9	10	10
drop table t1;
create table t1(
d int not null,
e int     null,
f int     null,
a int not null,
b int not null,
c int not null,
primary key (a,b,c))
engine = ndb partition by key (b);
insert into t1(a,b,c,d,e,f) values
(1, 2, 3, 1, 2, 3),
(1, 2, 4, 1, 2, 3),
(2, 3, 4, 1, 2, 3),
(3, 4, 5, 1, 2, 3),
(4, 5, 6, 1, 2, 3),
(5, 6, 7, 1, 2, 3),
(6, 7, 8, 1, 2, 3),
(7, 8, 9, 1, 2, 3);
set ndb_join_pushdown=on;
explain
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	NULL	NULL	NULL	NULL	8	Parent of 2 pushed join@1
1	SIMPLE	y	ref	PRIMARY	PRIMARY	8	test.x.d,test.x.e	1	Child of pushed join@1
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 partition by key (a);
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 partition by key (a,b);
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 partition by key (b,a);
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 partition by key (b);
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=2;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 partition by key (a);
select straight_join * from t1 x, t1 y where y.a=1 and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
select straight_join * from t1 x, t1 y where y.a=0 and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
alter table t1 partition by key (a,b);
select straight_join * from t1 x, t1 y where y.a=1 and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=2;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
alter table t1 drop primary key, add primary key using hash (d,b,a,c);
alter table t1 partition by key (b);
create index ix1 on t1(b,d,a);
explain
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	ALL	PRIMARY	NULL	NULL	NULL	8	Parent of 2 pushed join@1
1	SIMPLE	y	ref	ix1	ix1	4	test.x.e	1	Child of pushed join@1; Using where
insert into t1(a,b,c,d,e,f) values
(8, 9, 0, 1,  NULL, 3),
(9, 9, 0, 1,  2,    NULL);
alter table t1 partition by key (b);
select straight_join * from t1 x, t1 y where y.a=x.d and y.b=x.e;
d	e	f	a	b	c	d	e	f	a	b	c
1	2	3	1	2	3	1	2	3	1	2	3
1	2	3	1	2	3	1	2	3	1	2	4
1	2	3	1	2	4	1	2	3	1	2	3
1	2	3	1	2	4	1	2	3	1	2	4
1	2	3	2	3	4	1	2	3	1	2	3
1	2	3	2	3	4	1	2	3	1	2	4
1	2	3	3	4	5	1	2	3	1	2	3
1	2	3	3	4	5	1	2	3	1	2	4
1	2	3	4	5	6	1	2	3	1	2	3
1	2	3	4	5	6	1	2	3	1	2	4
1	2	3	5	6	7	1	2	3	1	2	3
1	2	3	5	6	7	1	2	3	1	2	4
1	2	3	6	7	8	1	2	3	1	2	3
1	2	3	6	7	8	1	2	3	1	2	4
1	2	3	7	8	9	1	2	3	1	2	3
1	2	3	7	8	9	1	2	3	1	2	4
1	2	NULL	9	9	0	1	2	3	1	2	3
1	2	NULL	9	9	0	1	2	3	1	2	4
pruned
14
const_pruned
6
drop table t1;
create table t1 (pk int primary key, a int, b int) engine=ndb;
create index ix1 on t1(b,a);
insert into t1 values (0,10,10);
insert into t1 values (1,10,20);
insert into t1 values (2,20,20);
insert into t1 values (3,10,10);
insert into t1 values (4,10,20);
insert into t1 values (5,10,20);
insert into t1 values (6,10,10);
insert into t1 values (7,10,10);
insert into t1 values (8,10,20);
insert into t1 values (9,10,10);
explain select x1.pk,x1.a,x1.b from t1 as x1 
join t1 as x2 on x1.a=x2.b 
join t1 as x3 on x2.a=x3.b 
order by x1.pk limit 70;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	index	NULL	PRIMARY	4	NULL	10	Parent of 3 pushed join@1; Using temporary; Using filesort
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
1	SIMPLE	x3	ref	ix1	ix1	5	test.x2.a	1	Child of pushed join@1; Using where
select x1.pk,x1.a,x1.b from t1 as x1 
join t1 as x2 on x1.a=x2.b 
join t1 as x3 on x2.a=x3.b 
order by x1.pk limit 70;
pk	a	b
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
0	10	10
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
1	10	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
2	20	20
explain select * from t1 as x1, t1 as x2 where x1.a=x2.b and x1.b = 3;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ref	ix1	ix1	5	const	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	x2	ref	ix1	ix1	5	test.x1.a	1	Child of pushed join@1; Using where
select * from t1 as x1, t1 as x2 where x1.a=x2.b and x1.b = 3;
pk	a	b	pk	a	b
drop table t1;
create table t (pk int primary key, a int) engine=ndb;
insert into t values 
(1,1), (2,1),
(4,3), (6,3),
(7,4), (8,4);
explain
SELECT DISTINCT STRAIGHT_JOIN table1.pk FROM 
t AS table1  JOIN
(t AS table2  JOIN  
(t AS table3  JOIN t AS table4 ON table3.pk = table4.a)
ON table2.pk =  table3.pk )
ON table1.a =  table4.pk
WHERE  table2.pk != 6;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	table1	ALL	NULL	NULL	NULL	NULL	6	Parent of 2 pushed join@1; Using temporary
1	SIMPLE	table2	range	PRIMARY	PRIMARY	4	NULL	2	Parent of 2 pushed join@2; Using where with pushed condition; Distinct
1	SIMPLE	table3	eq_ref	PRIMARY	PRIMARY	4	test.table2.pk	1	Child of pushed join@2; Distinct
1	SIMPLE	table4	eq_ref	PRIMARY	PRIMARY	4	test.table1.a	1	Child of pushed join@1; Using where; Distinct
SELECT DISTINCT STRAIGHT_JOIN table1.pk FROM 
t AS table1  JOIN
(t AS table2  JOIN  
(t AS table3  JOIN t AS table4 ON table3.pk = table4.a)
ON table2.pk =  table3.pk )
ON table1.a =  table4.pk
WHERE  table2.pk != 6;
pk
1
2
drop table t;
create table t (b int, a int, primary key (a,b)) engine=ndb;
insert into t values(0,0);
explain
select * from t as t1 join t as t2 on t2.a=t1.a where t1.a < 8 or t1.a >= 8;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	0	NULL	10	Parent of 2 pushed join@1; Using where with pushed condition
1	SIMPLE	t2	ref	PRIMARY	PRIMARY	4	test.t1.a	1	Child of pushed join@1
select * from t as t1 join t as t2 on t2.a=t1.a where t1.a < 8 or t1.a >= 8;
b	a	b	a
0	0	0	0
drop table t;
CREATE TABLE tc(
a varchar(10) NOT NULL,
b varchar(10),
c varchar(10),
PRIMARY KEY (a),
UNIQUE KEY uk1 (b, c) 
)ENGINE=ndbcluster;
insert into tc values ('aa','bb', 'x'), ('bb','cc', 'x'), ('cc', 'dd', 'x');
explain select * from tc as x1 
right outer join tc as x2 on x1.b=x2.a   
left outer join tc as x3 on x2.b = x3.b and x1.c=x3.c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x2	ALL	NULL	NULL	NULL	NULL	3	
1	SIMPLE	x1	ref	uk1	uk1	13	test.x2.a	1	Parent of 2 pushed join@1
1	SIMPLE	x3	ref	uk1	uk1	26	test.x2.b,test.x1.c	1	Child of pushed join@1
select * from tc as x1 
right outer join tc as x2 on x1.b=x2.a   
left outer join tc as x3 on x2.b = x3.b and x1.c=x3.c;
a	b	c	a	b	c	a	b	c
NULL	NULL	NULL	aa	bb	x	NULL	NULL	NULL
aa	bb	x	bb	cc	x	bb	cc	x
bb	cc	x	cc	dd	x	cc	dd	x
explain select * from tc as x1, tc as x2 where x1.b=x2.a for update;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	uk1	NULL	NULL	NULL	3	
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	12	test.x1.b	1	
explain select * from tc as x1, tc as x2 where x1.b=x2.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x1	ALL	uk1	NULL	NULL	NULL	3	Parent of 2 pushed join@1
1	SIMPLE	x2	eq_ref	PRIMARY	PRIMARY	12	test.x1.b	1	Child of pushed join@1
drop table tc;
create temporary table spj_counts_at_end
select counter_name, sum(val) AS val 
from ndbinfo.counters 
where block_name='DBSPJ' 
group by counter_name;
select spj_counts_at_end.counter_name, spj_counts_at_end.val - spj_counts_at_startup.val 
from spj_counts_at_end, spj_counts_at_startup 
where spj_counts_at_end.counter_name = spj_counts_at_startup.counter_name
and spj_counts_at_end.counter_name <> 'LOCAL_READS_SENT'
       and spj_counts_at_end.counter_name <> 'REMOTE_READS_SENT'
       and spj_counts_at_end.counter_name <> 'LOCAL_RANGE_SCANS_SENT'
       and spj_counts_at_end.counter_name <> 'REMOTE_RANGE_SCANS_SENT'
       and spj_counts_at_end.counter_name <> 'SCAN_BATCHES_RETURNED';
counter_name	spj_counts_at_end.val - spj_counts_at_startup.val
CONST_PRUNED_RANGE_SCANS_RECEIVED	6
LOCAL_TABLE_SCANS_SENT	196
PRUNED_RANGE_SCANS_RECEIVED	16
RANGE_SCANS_RECEIVED	209
READS_NOT_FOUND	405
READS_RECEIVED	61
SCAN_ROWS_RETURNED	63867
TABLE_SCANS_RECEIVED	196
select sum(spj_counts_at_end.val - spj_counts_at_startup.val) as 'LOCAL+REMOTE READS_SENT'
       from spj_counts_at_end, spj_counts_at_startup 
where spj_counts_at_end.counter_name = spj_counts_at_startup.counter_name
and (spj_counts_at_end.counter_name = 'LOCAL_READS_SENT'
       or spj_counts_at_end.counter_name = 'REMOTE_READS_SENT');
LOCAL+REMOTE READS_SENT
29150
drop table spj_counts_at_startup;
drop table spj_counts_at_end;
scan_count
2010
pruned_scan_count
7
sorted_scan_count
7
pushed_queries_defined
346
pushed_queries_dropped
11
pushed_queries_executed
267
set ndb_join_pushdown = @save_ndb_join_pushdown;
