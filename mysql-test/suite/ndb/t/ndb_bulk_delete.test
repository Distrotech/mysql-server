#
# Basic test of bulk update interface.  Test counts number of execute
# as measurement of numbre of round trips to kernel.
#
-- source include/have_ndb.inc

--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings

create table t1 (a int key) engine ndb;
insert into t1 values (1);
insert into t1 select a+1 from t1;
insert into t1 select a+2 from t1;
insert into t1 select a+4 from t1;
insert into t1 select a+8 from t1;
insert into t1 select a+16 from t1;
insert into t1 select a+32 from t1;
insert into t1 select a+64 from t1;
insert into t1 select a+128 from t1;

--enable_info

--echo
--echo # test: simple delete of multiple pk's
--echo # expected result 1 roundtrips
--echo # 0 - info call
--echo # 0 - read the rows (with read before delete, this is 1)
--echo # 0 - delete the rows (without bulk update this is 5 + 1 for execute no commit)
--echo # 1 - delete the row + commit the transaction
--echo
--source include/ndb_init_execute_count.inc
delete from t1 where a in (1,7, 90, 100, 130);
--source include/ndb_execute_count.inc

# Test delete with non existant pk
# Bug 37153
--echo # expected result 1 roundtrips
--echo # 0 - info call
--echo # 0 - read the rows 
--echo # 0 - delete the rows 
--echo # 1 - commit
--echo # affected = 0
--echo
--source include/ndb_init_execute_count.inc
delete from t1 where a=1000;
--source include/ndb_execute_count.inc

--echo # expected result 1 roundtrips
--echo # 0 - info call
--echo # 0 - read the rows 
--echo # 0 - delete the rows 
--echo # 1 - commit
--echo # affected = 0
--echo
--source include/ndb_init_execute_count.inc
delete from t1 where a in (1000, 1001, 1002, 1003, 1004);
--source include/ndb_execute_count.inc


# cleanup
drop table t1;
