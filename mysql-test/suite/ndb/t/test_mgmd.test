--perl
use strict;

use strict;
use lib "lib/";
use My::Find;
use File::Basename;
use IO::File;

#
# Check if the needed executable is available
#
my $mysql_test_dir = $ENV{MYSQL_TEST_DIR} or die "Need MYSQL_TEST_DIR";
my $basedir = dirname($mysql_test_dir);
my $test_exe = my_find_bin($basedir,
		           ["storage/ndb/test/ndbapi", "bin"],
                           "testMgmd", NOT_REQUIRED);

#
# Communicate the location of the executable to the test
# by creating a temporary include file
#

my $vardir = $ENV{MYSQLTEST_VARDIR} or die "Need MYSQLTEST_VARDIR";

my $F = IO::File->new("$vardir/tmp/test_mgmd.inc", "w") or die;
if ($test_exe)
{
  print $F "let \$TEST_MGMD=$test_exe;\n";
}
else
{
  print $F "skip Could not find testMgmd;";
}
EOF

--source $MYSQLTEST_VARDIR/tmp/test_mgmd.inc

let NDBT_TMP_DIR=$MYSQLTEST_VARDIR/tmp;

echo TEST_MGMD: '$TEST_MGMD';
echo NDBT_BASE_PORT: $NDBT_BASE_PORT;
echo NDBT_TMP_DIR: $NDBT_TMP_DIR;
--exec $TEST_MGMD;

exit;