####################################
# SETUP
####################################
CREATE DATABASE statements_digest;
USE statements_digest;
CREATE TABLE t1(a int);
CREATE TABLE t2(a int);
CREATE TABLE t3(a int, b int);
CREATE TABLE t4(a int, b int);
CREATE TABLE t5(a int, b int, c int);
CREATE TABLE t6(a int, b int, c int, d int);
CREATE TABLE t11 (c CHAR(4));
CREATE TABLE t12 (c CHAR(4));
TRUNCATE TABLE performance_schema.events_statements_summary_by_digest;
####################################
# EXECUTION
####################################
SELECT 1 FROM t1;
1
SELECT 1 FROM `t1`;
1
SELECT 1,2 FROM t1;
1	2
SELECT 1, 2, 3, 4 FROM t1;
1	2	3	4
SELECT 1 FROM t2;
1
SELECT 1,2 FROM t2;
1	2
SELECT 1, 2, 3, 4 FROM t2;
1	2	3	4
INSERT INTO t1 VALUES (1);
INSERT INTO t2 VALUES (1);
INSERT INTO t3 VALUES (1, 2);
INSERT INTO t4 VALUES (1, 2);
INSERT INTO t5 VALUES (1, 2, 3);
INSERT INTO t1 VALUES (1), (2), (3);
INSERT INTO t1 VALUES (1), (2), (3), (4);
INSERT INTO t3 VALUES (1, 2), (3, 4), (5, 6);
INSERT INTO t5 VALUES (1, 2, 3), (4, 5, 6), (7, 8, 9);
INSERT INTO t1 VALUES (NULL);
INSERT INTO t3 VALUES (NULL,NULL);
INSERT INTO t3 VALUES (1,NULL);
INSERT INTO t3 VALUES (NULL,1);
INSERT INTO t6 VALUES (NULL, NULL, NULL, NULL);
INSERT INTO t6 VALUES (1, NULL, NULL, NULL);
INSERT INTO t6 VALUES (NULL, 2, NULL, NULL);
INSERT INTO t6 VALUES (1, 2, 3, NULL);
INSERT INTO t6 VALUES (1, 2, NULL, 4);
SELECT                                          1           +        1;
1           +        1
2
SELECT 1;
1
1
SELECT 1 /* This is an inline comment */ + 1;
1 /* This is an inline comment */ + 1
2
SELECT 1+
/*
this is a
multiple-line comment
*/
1;
1+
/*
this is a
multiple-line comment
*/
1
2
CREATE SCHEMA statements_digest_temp;
DROP SCHEMA statements_digest_temp;
CREATE DATABASE statements_digest_temp;
DROP DATABASE statements_digest_temp;
SELECT 1 FROM no_such_table;
ERROR 42S02: Table 'statements_digest.no_such_table' doesn't exist
CREATE TABLE dup_table (c char(4));
CREATE TABLE dup_table (c char(4));
ERROR 42S01: Table 'dup_table' already exists
DROP TABLE dup_table;
INSERT INTO t11 VALUES("MySQL");
Warnings:
Warning	1265	Data truncated for column 'c' at row 1
PREPARE stmt FROM "SELECT * FROM t12";
EXECUTE stmt;
c
EXECUTE stmt;
c
DEALLOCATE PREPARE stmt;
CREATE PROCEDURE p1() BEGIN SELECT * FROM t12; END//
CALL p1();
c
CALL p1();
c
DROP PROCEDURE p1;
CREATE FUNCTION `func`(a INT, b INT) RETURNS int(11) RETURN a+b //
select func(3,4);
func(3,4)
7
select func(13,42);
func(13,42)
55
DROP FUNCTION func;
CREATE TRIGGER trg BEFORE INSERT ON t12 FOR EACH ROW SET @a:=1;
INSERT INTO t12 VALUES ("abc");
INSERT INTO t12 VALUES ("def");
DROP TRIGGER trg;
####################################
# QUERYING PS STATEMENT DIGEST
####################################
SELECT DIGEST, DIGEST_TEXT, COUNT_STAR, SUM_ROWS_AFFECTED, SUM_WARNINGS,
SUM_ERRORS FROM performance_schema.events_statements_summary_by_digest;
DIGEST	DIGEST_TEXT	COUNT_STAR	SUM_ROWS_AFFECTED	SUM_WARNINGS	SUM_ERRORS
f179ae2f3568daafdf95e8d26286df40	TRUNCATE TABLE performance_schema . events_statements_summary_by_digest  	1	0	0	0
d6ab54f66e4a40e7f5685fda9f1b8996	SELECT ? FROM t1  	1	0	0	0
e171daba4068de1cf11584d224640fca	SELECT ? FROM `t1`  	1	0	0	0
89c94dbe9eaa44ff16208c48b9635a09	SELECT ?, ... FROM t1  	2	0	0	0
52d70d49081856a8471a46aac8519e2b	SELECT ? FROM t2  	1	0	0	0
7f2ae4ab3a1d75d88a182a348fc3d415	SELECT ?, ... FROM t2  	2	0	0	0
0355a3b435784167943a75c2a7c5312d	INSERT INTO t1 VALUES (?)  	1	1	0	0
0d3557a9ef425cd98e80d026744e446d	INSERT INTO t2 VALUES (?)  	1	1	0	0
c0f6087f01441c24aea229a0d1537d5c	INSERT INTO t3 VALUES (...)  	4	4	0	0
b55b1670f25562bcf4d65641a6cc5001	INSERT INTO t4 VALUES (...)  	1	1	0	0
bc60b31eafbdc7f6cdef44a088c932e4	INSERT INTO t5 VALUES (...)  	1	1	0	0
8169aceb276d00c6b840084f48c27551	INSERT INTO t1 VALUES (?) /* , ... */  	2	7	0	0
938c2c087fda0f7716fe9477e09d6e87	INSERT INTO t3 VALUES (...) /* , ... */  	1	3	0	0
ecaf67c52e56814b2505ff420e390d69	INSERT INTO t5 VALUES (...) /* , ... */  	1	3	0	0
b741503f32e7e4d7f6b22a0283fae829	INSERT INTO t1 VALUES ( NULL )  	1	1	0	0
f6b5b808e6c08721a0d14be1b1514d5e	INSERT INTO t6 VALUES (...)  	5	5	0	0
cb4fca9a44b33f9412f9abacf91cc854	SELECT ? + ?  	3	0	0	0
4602e592cdee38a26557bd0d9215be35	SELECT ?  	1	0	0	0
c971c8e991c110c98d36f618b0d4f080	CREATE SCHEMA statements_digest_temp  	2	2	0	0
5aabfd327c59e12e5efff109687e59e5	DROP SCHEMA statements_digest_temp  	2	0	0	0
24bc63079bb4bb22c6d56956845f9f22	SELECT ? FROM no_such_table  	1	0	0	1
5052d57e550edcda9e031d580563563d	CREATE TABLE dup_table ( c CHARACTER (?) )  	2	0	0	1
da533ad6c950c444d223ae1669b34eb1	DROP TABLE dup_table  	1	0	0	0
d66abc28b6eb13ae2b8fdf682e6e8205	INSERT INTO t11 VALUES (?)  	1	1	1	0
fb16be66cd2f46920a3d7d0329d83e44	SHOW WARNINGS  	1	0	0	0
bd867d4bea3c66a396b1ff328b0f2388	PREPARE stmt FROM ?  	1	0	0	0
9bc31ccd137630c2c9e6b4062c4576a8	EXECUTE stmt  	2	0	0	0
140e00113ca4134a7378e7c6e4591798	DEALLOCATE PREPARE stmt  	1	0	0	0
e5aef81f8daaabbb87c3cf8f4ef7e048	CREATE PROCEDURE p1 ( ) BEGIN SELECT * FROM t12 ; END  	1	0	0	0
b18d0fc42dadff72ad682bc959b25613	CALL p1 ( )  	2	0	0	0
2a3fe2f3fbb24c75bb39e5a493dd5f8e	DROP PROCEDURE p1  	1	0	0	0
2cb88d38ed288f251c9b6bf8614f6625	CREATE FUNCTION `func` ( a INTEGER , b INTEGER ) RETURNS INTEGER (?) RETURN a + b  	1	0	0	0
e4c8a3d91e3fa50ccf4cb5562852e882	SELECT func (...)  	2	0	0	0
1a877d7135862fc121e3a6ee1e1d82d4	DROP FUNCTION func  	1	0	0	0
eb7b97e334308d4f4e5eb5bba2457d66	CREATE TRIGGER trg BEFORE INSERT ON t12 FOR EACH ROW SET @ ? := ?  	1	0	0	0
77cd6962d21dc2406f457639d9b61ffd	INSERT INTO t12 VALUES (?)  	2	2	0	0
8b3bc89d52f67870331670b0aebf235e	DROP TRIGGER trg  	1	0	0	0
####################################
# CLEANUP
####################################
DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
DROP TABLE IF EXISTS t3;
DROP TABLE IF EXISTS t4;
DROP TABLE IF EXISTS t5;
DROP TABLE IF EXISTS t6;
DROP TABLE IF EXISTS t11;
DROP TABLE IF EXISTS t12;
DROP DATABASE IF EXISTS statements_digest;
