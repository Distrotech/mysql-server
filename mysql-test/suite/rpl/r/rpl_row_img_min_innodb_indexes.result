stop slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
reset master;
reset slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
start slave;
include/stop_slave.inc
RESET MASTER;
include/stop_slave.inc
RESET SLAVE;
RESET MASTER;
RESET SLAVE;
CHANGE MASTER TO master_host='127.0.0.1',master_port=MASTER_A_PORT,master_user='root',MASTER_LOG_FILE='MASTER_A_LOG_FILE';
RESET MASTER;
include/stop_slave.inc
RESET SLAVE;
CHANGE MASTER TO master_host='127.0.0.1',master_port=MASTER_B_PORT,master_user='root',MASTER_LOG_FILE='MASTER_B_LOG_FILE';
SHOW VARIABLES LIKE 'server_id';
Variable_name	Value
server_id	1
SHOW VARIABLES LIKE 'server_id';
Variable_name	Value
server_id	2
SHOW VARIABLES LIKE 'server_id';
Variable_name	Value
server_id	3
include/start_slave.inc
include/start_slave.inc
####  Chained replication: A -> B -> C ####
#################################################################
# CASE 1: InnoDB - A, MyISAM - B,C
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 2: InnoDB - A,B,C
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 3: MyISAM - A, InnoDB - B,C
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 4: MyISAM - A,C, InnoDB - B
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 5: MyISAM - B, InnoDB - A,C
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 6: InnoDB - C, MyISAM - A,B
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= MyISAM;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
#################################################################
# CASE 7: InnoDB - A,C MyISAM - C
#################################################################
DROP TABLE IF EXISTS t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R4: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: none --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R3: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: K --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R2: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: UK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 blob, c3 int, unique key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
#### WL#5096
#### Requirement R1: Replication must not break when different
####                 indexes exist on master and slave and PKE
####                 is not declared in a column that does not
####                 exist on the slave.
####                 Master: PK --> Slave: PK, UK, K, none
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c3)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, key(c2(512))) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, unique key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob NOT NULL, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c2(512))) engine= InnoDB;;
CREATE TABLE t (c1 int, c2 blob, c3 int, primary key(c1)) engine= MyISAM;;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
SET SQL_LOG_BIN=1;
INSERT INTO t VALUES (1, "a", 10);
INSERT INTO t VALUES (2, "b", 20);
INSERT INTO t VALUES (3, "c", 30);
UPDATE t SET c1=10 WHERE c2="a";
UPDATE t SET c1=20 WHERE c1=2;
UPDATE t SET c1=30 WHERE c3=30;
UPDATE t SET c3=40 WHERE c1=30;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DELETE FROM t WHERE c2="a";
DELETE FROM t WHERE c1=20;
DELETE FROM t;
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
Comparing tables mysqld_a:test.t and mysqld_b:test.t (Chained replication 3 hosts)
Comparing tables master:test.t and slave:test.t
DROP TABLE t;
