--source include/have_binlog_format_row.inc

--source include/master-slave.inc

######## Generate some data on master ########

CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (4);
# note: CREATE...SELECT will be logged as two groups on slave
CREATE TABLE t5 SELECT * FROM t1;
SET GTID_NEXT = 'ANONYMOUS';
INSERT INTO t1 VALUES (0);
INSERT INTO t1 VALUES (6);
INSERT INTO t1 VALUES (7);

######## Sync to slave ########

--sync_slave_with_master

--let $server_uuid= `SELECT @@GLOBAL.SERVER_UUID`
--let $datadir= `SELECT @@datadir`
--let $binlog_file= query_get_value(SHOW MASTER STATUS, File, 1)

######## See output from mysqlbinlog ########

--echo ================ FULL FILE ================
--exec $MYSQL_BINLOG $datadir/$binlog_file | grep '^# Subgroup'
--exec $MYSQL_BINLOG $datadir/$binlog_file

--echo ================ 2,4-5 ================
--exec $MYSQL_BINLOG --include-gtid=$server_uuid:2:4-5 $datadir/$binlog_file | grep '^# Subgroup'
--exec $MYSQL_BINLOG --include-gtid=$server_uuid:2:4-5 $datadir/$binlog_file

--echo ================ 1,3,ANON ================
--exec $MYSQL_BINLOG --exclude-gtid=$server_uuid:2:4-5 $datadir/$binlog_file | grep '^# Subgroup'
--exec $MYSQL_BINLOG --exclude-gtid=$server_uuid:2:4-5 $datadir/$binlog_file

--echo ================ 1,3,ANON ================
--exec $MYSQL_BINLOG --include-gtid=$server_uuid:1,ANONYMOUS,$server_uuid:3 $datadir/$binlog_file | grep '^# Subgroup'
--exec $MYSQL_BINLOG --include-gtid=$server_uuid:1,ANONYMOUS,$server_uuid:3 $datadir/$binlog_file

--echo ================ 2-5 ================
--exec $MYSQL_BINLOG --first-lgid=2 --last-lgid=5 $datadir/$binlog_file | grep '^# Subgroup'
--exec $MYSQL_BINLOG --first-lgid=2 --last-lgid=5 $datadir/$binlog_file

--connection master
DROP TABLE t1, t5;
--source include/rpl_end.inc
