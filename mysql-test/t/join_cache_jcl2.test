set optimizer_switch='block_nested_loop=off';
let $requires_join_cache_level = 2;
--source include/have_join_cache_level.inc

--eval set optimizer_join_cache_level = $requires_join_cache_level;

if (`select locate('mrr_cost_based', @@optimizer_switch) > 0`) 
{
  set optimizer_switch='mrr_cost_based=off';
}

--source include/join_cache.inc

set optimizer_join_cache_level = default;
set optimizer_switch = default;
