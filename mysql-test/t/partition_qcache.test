-- source include/have_query_cache.inc
-- source include/have_partition.inc

let $old_qc_size= `SELECT @@global.query_cache_size`;
set GLOBAL query_cache_size=1355776;
CREATE TABLE t1
(`NUM` varchar(4) NOT NULL,
 `UPDATE_TIME` datetime NOT NULL,
 PRIMARY KEY (`NUM`,`UPDATE_TIME`))
PARTITION BY RANGE (month(UPDATE_TIME))
(PARTITION p2 VALUES LESS THAN (3) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (4) ENGINE = InnoDB);

SELECT * FROM t1 WHERE MONTH(update_time)=3;

INSERT INTO t1 VALUES ('AAA', '2010-03-11 00:00:00');

SELECT * FROM t1 WHERE MONTH(update_time)=3;

ALTER TABLE t1 TRUNCATE PARTITION p3;
commit;

SELECT * FROM t1 WHERE MONTH(update_time)=3;

SELECT SQL_NO_CACHE * FROM t1 WHERE MONTH(update_time)=3;

ALTER TABLE t1 DROP PARTITION p3;

SELECT * FROM t1 WHERE MONTH(update_time)=3;
DROP TABLE t1;

eval SET GLOBAL query_cache_size= $old_qc_size;
